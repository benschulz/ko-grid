/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var v;
(function(B){"function"===typeof define&&define.amd?define(["require","knockout","ko-data-source","ko-indexed-repeat"],B):window["ko-grid"]=B(function(r,t){if(!Array.isArray(r)||1!==r.length||"string"!==typeof r[0]||"function"!==typeof t)throw Error("Assertion error.");var x=window.ko.bindingHandlers.grid.config=window.ko.bindingHandlers.grid.config||{};t(x[r[0]])},window.ko)})(function(B,r){var t,x,G,H,y,I,D;t=function(){var b;b=function(){function b(h,k){return Object.prototype.hasOwnProperty.call(h,k)}
return{ab:function(b,k){if(b===k)return!0;var g=!!k&&"function"===typeof k.valueOf;return!!b&&"function"===typeof b.valueOf&&g&&b.valueOf()===k.valueOf()},extend:function(b,k){Array.prototype.slice.call(arguments,1).forEach(function(g){for(var e=Object.keys(g),a=0,d=e.length;a<d;a++){var c=e[a],f=Object.getOwnPropertyDescriptor(g,c);void 0!==f&&f.enumerable&&Object.defineProperty(b,c,f)}});return b},aa:function(h,k){for(var g in h)b(h,g)&&k(g,h[g])},p:b,xb:function(h,k){var g={},e;for(e in h)b(h,
e)&&(g[e]=k(h[e],e,h));return g}}}();return function(b){return b}(function(b,h,k){return{f:b,c:h,H:k}}(function(b){function h(a){return a.filter(function(a,c,f){return f.lastIndexOf(a)===c})}function k(a,d){for(var c=a.length,f=-1,q=0;q<c;++q)if(d(a[q])){if(0<=f)throw Error("Multiple elements match the predicate.");f=q}return f}function g(a,d){return a&&"function"===typeof a.valueOf&&d&&"function"===typeof d.valueOf?a.valueOf()<=d.valueOf()?a.valueOf()<d.valueOf()?-1:0:1:a<=d?a<d?-1:0:1}function e(a,
d){var c=a.length,f=Array(c),q=Array(c),m;for(m=0;m<c;++m)f[m]=m,q[m]=a[m];m=a;a=q;q=m;f.sort(function(c,w){return d(a[c],a[w])||c-w});for(m=0;m<c;++m)q[m]=a[f[m]];return q}return{contains:function(a,d){return 0<=a.indexOf(d)},mb:function(a){if(50<a.length){for(var d=a.length,c={},f,q=0;q<d;++q)if(f=a[q],"string"===typeof f)if(b.p(c,f))break;else c[f]=!0;else if(a.lastIndexOf(f)!==q)break;if(!(q>=d)){for(var m=a.slice(0,q);q<d;++q)f=a[q],"string"===typeof f?b.p(c,f)||(c[f]=!0,m.push(f)):a.lastIndexOf(f)===
q&&m.push(f);a=m}}else a=h(a);return a},$:function(a,d){return Array.prototype.concat.apply([],a.map(d))},Db:function(a,d){var c=k(a,d);if(0>c)throw Error("None of the elements matches the predicate.");return a[c]},Eb:function(a,d){var c=k(a,d);return 0<=c?a[c]:null},Pa:function(a,d){var c=d||g;window.chrome?c=e(a,c):(a.sort(c),c=a);return c}}}(b),b,{ra:function(b){return b.replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()})},hb:function(b){return b.replace(/-([a-z])/g,function(b){return b[1].toUpperCase()})},
format:function(b){var h=arguments;return b.replace(/{(\d+)}/g,function(b,g){var e=parseInt(g,10)+1;return typeof h.length<=e?b:h[e]})}}))}();x=function(b,l){function h(b){var e={key:["char","charCode","key","keyCode"],mouse:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" ")},e="altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp type view which".split(" ").concat(e[b.type.substr(0,3)]||[]).concat(e[b.type.substr(0,
5)]||[]);this.J=b;this.b=b.defaultPrevented;e.forEach(function(a){return Object.defineProperty(this,a,{get:function(){return b[a]}})}.bind(this))}function k(b,e){this.ba=b;this.Oa=e}h.prototype={preventDefault:function(){this.b=!0;return this.J.preventDefault()},k:function(){this.b=!0},get defaultPrevented(){return this.b}};h.prototype=b.c.extend({},{get defaultPrevented(){return this.defaultPrevented},preventDefault:h.prototype.preventDefault,preventApplicationButAllowBrowserDefault:h.prototype.k},
h.prototype);return function(g){function e(d,c,f){function q(a){a=Array.prototype.slice.call(d.querySelectorAll(a)).filter(function(a){return l.Aa(a,c.target)});return a.length?a[a.length-1]:void 0}var m=l.ua.bind(null,d),n=a.map(function(a){var c=a.Oa?q(a.Oa):d;return{ba:a.ba,match:c,depth:c?m(c):-1}}).filter(function(a){return!!a.match});b.f.Pa(n,function(a,c){return c.depth-a.depth});n.forEach(function(a){a.ba.apply(d,f)})}g=g||function(a){return[a]};var a=[];this.q=function(d,c){var b=1<arguments.length?
d:void 0;c=1<arguments.length?c:d;a.push(new k(c,b));return{dispose:function(){c&&(a.splice(a.indexOf(c),1),c=null)}}};this.fa=function(a){return{Y:function(c){var b=l.element.pa(c.target,a);b&&(c=new h(c),e(b,c,g(c,b)))}}}}}(t,function(){return function(b){return b}(function(){function b(b,g){return!!(b.compareDocumentPosition(g)&16)}var l=window.Element,h=l.prototype.webkitMatchesSelector||l.prototype.mozMatchesSelector||l.prototype.msMatchesSelector||l.prototype.matches;return{ua:function(b,g){for(var e=
0;g;){if(g===b)return e;g=g.parentNode;++e}throw Error("The given node is not part of the subtree.");},Aa:function(k,g){return k===g||b(k,g)},Fb:b,element:{pa:function(b,g){do{if(h.call(b,g))return b;b=b.parentElement}while(b);return null},matches:function(b,g){return h.call(b,g)}}}}())}());G=function(){var b=/^[a-z]+(-[a-z]+)*$/,l=/\x3c!--(?:(before|after):)?([a-z]+(-[a-z]+)*)--\x3e*/g;return function(h){function k(b,d){d=d||function(a,b){return b+a};return function(m){var n=g(m,b);return{M:function(b,
f){var m=f?b:null,z=(f=f?f:b)?m:null,F=f,m=d;z&&a(z,2);e(F);z=z?g(z,3)+F+g(z,4):F;m=m(n,z);c=c.replace(n,m)}}}}function g(a,b){function c(b){if(d[a]!==b)throw Error("Operation is not defined for placeholder `"+a+"`.");}if(!d[a])throw Error("Unknown placeholder id `"+a+"`.");var n="\x3c!--"+a+"--\x3e",w="\x3c!--before:"+a+"--\x3e",e="\x3c!--after:"+a+"--\x3e";switch(b){case 1:return c(1),delete d[a],n;case 2:return c(1),n;case 3:return c(2),w;case 4:return c(2),e;case 5:case 6:return 1===d[a]?n:5===
b?e:w}throw Error("Assertion error. Unkown operator: `"+b+"`");}function e(b){for(var c;c=l.exec(b);){var d=c[1],n="before"===d;c=c[2];if(d&&1!==(b.match(new RegExp((n?"after":"before")+":"+c,"g"))||[]).length)throw Error("Multiple or unmatched before-/after-placeholders for placeholder id `"+c+"`.");d&&!n||a(c,d?2:1)}}function a(a,c){if(!b.test(a))throw Error("Invalid placeholder id `"+a+"`");if(d[a])throw Error("Placeholder id `"+a+"` is already taken.");d[a]=c}var d={},c=h;e(c);this.replace=function(a){return{ha:k(1,
function(a,b){return b})(a).M}};this.Ra=function(a){return{append:k(5)(a).M,Ka:k(6,function(a,b){return a+b})(a).M}};this.cb=function(){return c.replace(l,"")}}}();H=function(b,l,h){function k(b){return null===b?"":""+b}function g(e,a,d){this.id=this.id=d.id;this.property=this.ea=d.property||this.id;this.userDefined=this.ga=!1!==d.ga;this.m=!d.hidden;this.visible=this.J=function(){return this.m}.bind(this);this.label=this.label=b.observable(d.label);this.width=this.width=b.observable(d.width);this.widthInPixels=
this.Q=function(){var a=this.width();if("px"!==a.substr(-2))throw Error("The only currently supported column width values are absolute pixel lengths.");return parseInt(a.substring(0,a.length-2),10)}.bind(this);this.ya=b.observableArray(d.headerClasses||d.classes||[]);this.oa=b.observableArray(d.cellClasses||d.classes||[]);this.b=b.observableArray(d.footerClasses||d.classes||[]);this.headerClasses=this.ya;this.cellClasses=this.oa;this.footerClasses=this.b;this.metadata=this.ib=a.columnMetadataSupplier?
a.columnMetadataSupplier(e.bb,d):{};this.renderValue=this.F=a.cellValueRenderer?a.cellValueRenderer.bind(void 0,this):k;this.nb=function(a){this.F=a(this.F)}.bind(this);this.k=function(a){a=this.ka(a,{e:this.W,update:this.X});if(!a||!a.e||!a.update)throw Error("The cell value binding must define an `init` as well as an `update` method.");this.W=a.e;this.X=a.update}.bind(this);this.ka=function(a,b){var d=a(l.c.extend({e:b.e,update:b.update},{init:b.e,update:b.update}));return{e:d.e||d.init,update:d.update||
d.update}};this.overrideValueRendering=this.nb;this.overrideValueBinding=this.k}b.bindingHandlers.__gridColumn={init:function(){},update:function(b,a){var d=a();b.style.width=d.width()}};return{e:function(b){b.replace("columns").ha(h)},r:function(e,a,d){function c(b){b=new g(d,a,b);a.columnInitializer&&a.columnInitializer(b);return b}this.all=this.all=b.observableArray(e.columns.map(c));this.byId=this.na=function(a){var b=this.Sa(a);if(!b)throw Error("The column id `"+a+"` is undefined.");return b}.bind(this);
this.tryById=this.Sa=function(a){var b=this.all().filter(function(b){return b.id===a});if(1<b.length)throw Error("Assertion error: Multiple columns with id `"+a+"`.");return b[0]}.bind(this);var f=b.observable(this.all().filter(function(a){return a.m}));this.displayed=this.i=function(){return f()};this.show=function(a){this.G(function(b){return b.m||b===a})}.bind(this);this.qb=function(a){this.G(function(b){return b.m&&b!==a})}.bind(this);this.show=this.show;this.hide=this.qb;this.reorder=this.Cb=
function(a){var b=this.all().slice(),d=[];a.forEach(function(a){b.splice(b.indexOf(a),1);d.push(a)});if(b.length)throw Error("The new column order must contain all columns.");this.all(d);this.G(function(a){return a.m})}.bind(this);this.showOnlyThoseWhich=this.G=function(a){var b=this.all();a=b.filter(a);b.forEach(function(a){a.m=!1});a.forEach(function(a){a.m=!0});f(a)}.bind(this);this.combinedWidth=this.fb=b.pureComputed(function(){for(var a=0,b=this.i(),d=0;d<b.length;++d)a+=b[d].Q();return a}.bind(this));
this.add=this.add=function(a){a=c({ga:!1,id:"$"+a.id,label:a.label,hidden:a.hidden||!1,width:a.width});this.all.unshift(a);this.G(function(a){return a.m});return a}.bind(this)}}}(r,t,'<colgroup class="ko-grid-colgroup">\n    <col class="ko-grid-col" data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\' }" data-repeat-bind="__gridColumn: column()">\n</colgroup>');y=function(b){var l,h,k;l=function(b){return function(e,a){return b.c.extend(e,{get stringifyable(){return a()}})}}(b);
h=function(b,e){function a(){return 0}function d(a,b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function c(a,d){b.c.extend(a,{get onResultOf(){return this.D},get reverse(){return this.reverse},get callable(){return this.C}},{get D(){return function(b){return f(b,a)}},get reverse(){return function(){return d||h(a)}},get C(){return a}})}function f(a,b){function d(c,e){return b(a(c),a(e))}c(d);e(d,function(){return{type:"by-function-comparator","function":a.stringifyable,
comparator:b.stringifyable}});return d}function h(a){function b(d,c){return-a(d,c)}c(b,a);e(b,function(){return{type:"reversed-comparator",comparator:a.stringifyable}});return b}c(d);e(d,function(){return{type:"natural-comparator"}});c(a);e(a,function(){return{type:"indifferent-comparator"}});return{tb:a,b:d}}(b,l);k=function(b,e){function a(a){b.c.extend(a,{get callable(){return this.C}},{get C(){return a}})}return{Ab:function(b){function c(a){return a[b]}a(c);e(c,function(){return{type:"property-accessor",
propertyName:b}});return c}}}(b,l);b=function(b,e){function a(){return!0}function d(){return!1}function c(a,d){b.c.extend(a,{get and(){return this.B},get negate(){return this.Da},get onResultOf(){return this.D},get or(){return this.P},get callable(){return this.C}},{get B(){return function(b){return f([a,b])}},get Da(){return function(){return d||m(a)}},get D(){return function(b){return h(b,a)}},get P(){return function(b){return n([a,b])}},get C(){return a}})}function f(b){function d(a){for(var c=
0,e=b.length;c<e;++c)if(!b[c](a))return!1;return!0}if(!b.length)return a;c(d);e(d,function(){return{type:"and-predicate",components:b.map(function(a){return a.stringifyable})}});return d}function h(a,b){function d(c){return b(a(c))}c(d);e(d,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:b.stringifyable}});return d}function m(a){function b(d){return!a(d)}c(b,a);e(b,function(){return{type:"negated-predicate",predicate:a.stringifyable}});return b}function n(a){function b(d){for(var c=
0,e=a.length;c<e;++c)if(a[c](d))return!0;return!1}if(!a.length)return d;c(b);e(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}c(d);e(d,function(){return{type:"always-false-predicate"}});c(a);e(a,function(){return{type:"always-true-predicate"}});return{b:d,k:a,B:f,J:function(a,b){function d(b){return a(b)}c(d);e(d,b);return d},P:n,Bb:function(a){function b(d){return a.test(d)}c(b);e(b,function(){return{type:"regular-expression-predicate",regularExpression:a.source,
caseSensitive:!a.ignoreCase,multiline:a.multiline}});return b}}}(b,l);return function(b){return b}({v:h,L:k,j:b,wb:l,Gb:function(b,e){return"function"===typeof e||"object"===typeof e?e.stringifyable||e:e}})}(t);y=function(b,l,h,k,g){function e(a){this.l(function(b){b();this.t=a.element.querySelector(".ko-grid-tbody")}.bind(this));return function(){this.t=null}.bind(this)}function a(){var a=[],d={};this.rows=this.rows=d;d.i=b.observableArray([]);d.displayed=d.i;d.Z=b.observable(!1).extend({Qb:"always"});
d.displayedSynchronized=d.Z;d.__handleDisplayedRowsDeviate=function(){this.rows.Z(!1)}.bind(this);d.__handleDisplayedRowsSynchronized=function(){this.rows.Z(!0)}.bind(this);var c=this.view;d.__dirty=c.dirty;a.push(c.observables.subscribe(function(a){d.i(a)}));d.i(c.observables());var e=[];d.__classify=function(a){var b=e.map(function(b){return b(a)});return Array.prototype.concat.apply([],b)};d.za=function(a){e.push(a)};d.installClassifier=d.za;return function(){a.forEach(function(a){a.dispose()})}}
function d(){function a(d,c){var e=b.contextFor(c),n=e.row(),e=e.column();return[d,n[e.ea],n,e]}function d(a){return function(b){a.fa(".ko-grid-cell").Y(b);return!b.defaultPrevented}}var c=new k(a),e=new k(a),n=new k(a),f=new k(a);this.zb=c.q.bind(c);this.Ea=e.q.bind(e);this.Fa=n.q.bind(n);this.yb=f.q.bind(f);this.onCellMouseDown=this.zb;this.onCellClick=this.Ea;this.onCellDoubleClick=this.Fa;this.onCellContextMenu=this.yb;this.l(function(a){a();this.t.addEventListener("mousedown",d(c));this.t.addEventListener("click",
d(e));this.t.addEventListener("dblclick",d(n));this.t.addEventListener("contextmenu",d(f))}.bind(this));return function(){}}function c(a){function d(a,b){var c=a.children[b];if(!c)throw Error("Column `"+b+"` does not exist.");return c}function c(b,d,e){var n=b.row();p(n,function(b){var c=b.n,f=a.h.i().indexOf(c);e(b,d.children[f],n,c)})}var e=function(a){var b=this.t.querySelector("tr.ko-grid-row:nth-child("+(a+1)+")");if(!b)throw Error("Row `"+a+"` does not exist.");return b}.bind(this),g=0,h={};
this.rows.__handleElementRecycling=function(a,b){c(b,a,function(a,b,d,c){a.Qa();q(b,d,c)})};this.rows.__handleElementRecycled=function(a,b){c(b,a,function(a,b,d,c){a.Na(d,b);q(b,d,c);m(b,d,c)})};var p=function(d,c){if(g){var e=this.ca(b.unwrap(d[a.primaryKey]));l.c.p(h,e)&&h[e].forEach(c)}}.bind(this);this.Za=function(a,b){var d=a.row(),c=a.column();p(d,function(a){a.n===c&&b(a)})};this.lookupCell=this.Ca=function(c,p){function J(a){function b(){1===e.length?delete h[k]:e.splice(e.indexOf(d),1);--g;
if(!d.Hb){var a=d.element,c=d.b,n=d.n;d.Qa();q(a,c,n);m(a,c,n)}}if(A["__@__hijacked"])throw Error("Illegal state: This cell is already hijacked.");a=p.ka(a,{e:p.W||n,update:p.X||w});var d=A["__@__hijacked"]=new f(A,c,p,a),e=h[k]=h[k]||[];e.push(d);++g;q(A,c,p);m(A,c,p);return l.c.extend({b:b,dispose:b},{dispose:b,release:b})}var k=this.ca(b.unwrap(c[a.primaryKey])),E=this.rows.i().tryFirstIndexOf(c),K=a.h.i().indexOf(p),A=d(e(E),K);return l.c.extend({element:A,rb:J},{element:A,hijack:J})}.bind(this);
return function(){}}function f(a,b,d,c){this.element=a;this.b=b;this.n=d;this.e=c.e;this.update=c.update}function q(a,d,c){for(var e=a["__@__hijacked"];a.firstChild;)b.removeNode(a.firstChild);(e&&e.e||c.W||n)(a,d,c)}function m(a,b,d){var c=b[d.ea],e=a["__@__hijacked"],n=d.oa.peek().join(" ");a.className="ko-grid-td ko-grid-cell "+n;(e&&e.update||d.X||w)(a,c,b,d)}function n(a){a.insertBefore(E.createTextNode(""),a.firstChild)}function w(a,d,c,e){for(a=a.firstChild;a.nodeType!==p;)a=a.nextSibling;
a.nodeValue=e.F(b.unwrap(d))}var p=window.Node.TEXT_NODE,E=window.document;f.prototype={get Hb(){return null===this.element},Na:function(a,b){this.element=b;this.b=a;b["__@__hijacked"]=this},Qa:function(){this.element=this.element["__@__hijacked"]=null}};b.bindingHandlers.__gridRow={init:function(){},update:function(a,b){var d=b(),c=d.classify,e=d.row(),d=1===d.index()%2?["ko-grid-tr","ko-grid-row","alternate"]:["ko-grid-tr","ko-grid-row"],c=c(e);a.className=d.concat(c).join(" ")}};b.bindingHandlers.__gridCell=
{init:function(a,b,d,c,e){b=b();var n=b.row;b=b.column;e.grid.data.Za(e,function(b){return b.Na(n(),a)});q(a,n,b());return{controlsDescendantBindings:!0}},update:function(a,b){var d=b(),c=d.row(),d=d.column.peek();m(a,c,d)}};return{e:function(a){a.replace("body").ha("body",g);a.Ra("table").Ka("<div class=\"ko-grid-load-indicator\" data-bind=\"style: { display: data.rows.__dirty() ? 'block' : 'none' }\">Loading&hellip;</div>")},r:function(n,f,g){var p=[];this.source=n.dataSource;this.valueSelector=
this.Ta=n.valueSelector||f.valueSelector||function(a){return a};this.observableValueSelector=this.ca=n.observableValueSelector||f.observableValueSelector||this.Ta;this.predicates=this.j=b.observableArray(n.filters||[]);this.predicate=this.Ja=b.pureComputed(function(){return h.j.B(this.j().map(b.unwrap))}.bind(this));this.comparator=this.qa=b.observable(h.v.tb);this.offset=this.offset=b.observable(0);this.limit=this.Ba=b.observable(Number.POSITIVE_INFINITY);n=this.source.openView(function(a){return a.filteredBy(this.Ja).sortedBy(this.qa).offsetBy(this.offset).limitedTo(this.Ba)}.bind(this));
p.push(n.dispose.bind(n));this.view=this.view=n;this.A=function(){};this.l=function(a){var b=this.A;this.A=function(){a(b)}}.bind(this);p.push(e.call(this,g));p.push(a.call(this));p.push(d.call(this));p.push(c.call(this,g));this.u=function(){p.forEach(function(a){a()})}}}}(r,t,y,x,'<tbody class="ko-grid-tbody" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    <tr class="ko-grid-tr ko-grid-row"\n        data-bind="indexedRepeat: {\n            forEach: data.rows.displayed,\n            indexedBy: function(r) { return grid.data.observableValueSelector(ko.unwrap(r[grid.primaryKey])); },\n            as: \'row\',\n            at: \'rowIndex\',\n            beforeElementRecycling: data.rows.__handleElementRecycling,\n            afterElementRecycled: data.rows.__handleElementRecycled,\n            allowDeviation: true,\n            onDeviation: data.rows.__handleDisplayedRowsDeviate,\n            onSynchronization: data.rows.__handleDisplayedRowsSynchronized }"\n        data-repeat-bind="__gridRow: { classify: grid.data.rows.__classify, row: row, index: rowIndex }">\n\n        <td data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\', allowElementRecycling: false }"\n            data-repeat-bind="__gridCell: { row: row, column: column }"></td>\n    </tr>\n</tbody>');
I=function(b,l,h,k){function g(a){this.id=this.id="column-header-"+a.id;this.element=this.element=b.observable(null);this.rowSpan=this.rowSpan=b.observable(1);this.columnSpan=this.o=b.observable(1);this.label=this.label=a.label;this.column=this.n=a;this.columns=this.h=[a];this.U=function(a){this.rowSpan(a)}.bind(this)}function e(a){this.id=this.id="column-group-header-"+(a.id||"@__"+ ++m);this.element=this.element=b.observable(null);this.$a=a;this.rowSpan=this.rowSpan=b.observable(a.height);this.columnSpan=
this.o=b.observable(1);this.label=this.label=b.observable(a.label);this.columns=this.h=[];this.U=function(a){this.h=[a];this.o(1)}.bind(this)}function a(a){function b(a){a.eb.forEach(function(b){var d=c[b];if(!d)c[b]=a;else if(d!==a)throw Error("Column `"+b+"` is element of column group `"+d.label+"` as well as `"+a.label+"`.");});a.K&&b(a.K)}var c={};l.f.$(a,d.bind(this,null)).forEach(function(a){b(a)});return c}function d(a,b){var e=c(b),f=b.elements.filter(function(a){return"string"!==typeof a}),
g=b.elements.filter(function(a){return"string"===typeof a}),e={id:b.id,label:b.label,K:a,depth:a?a.depth+1:0,height:a?a.Ia-e:1,Ia:e,eb:g};return f.length?l.f.$(f,d.bind(this,e)):e}function c(a){a=a.elements.filter(function(a){return"string"!==typeof a});return 1+Math.max.apply(Math,[0].concat(a.map(c)))}var f=window.document,q=window.Node,m=0;b.bindingHandlers.__gridHeader={init:function(a,d){var c=d()();c.element(a);b.utils.domNodeDisposal.addDisposeCallback(a,function(){c.element(null)});a.insertBefore(f.createTextNode(""),
a.firstChild);return{controlsDescendantBindings:!0}},update:function(a,b){var d=b()(),c=d.id.replace(/[\s]/g,"_");a.className=d.n?"ko-grid-th ko-grid-column-header "+c+" "+d.n.ya().join(" "):"ko-grid-th ko-grid-column-group-header "+c;c=d.h.map(function(a){return a.Q()}).reduce(function(a,b){return a+b})+"px";a.style.width=c;a.style.maxWidth=c;a.rowSpan=d.rowSpan();a.colSpan=d.o();for(c=a.firstChild;c.nodeType!==q.TEXT_NODE;)c=c.nextSibling;c.nodeValue=d.label()}};return{e:function(a){a.replace("head").ha(k)},
r:function(d,c,f){function k(a,b,d){if(!a)return[];if(b[a.depth]&&b[a.depth].$a===a){var c=a;do{var f=b[c.depth];f.h.push(d);f.o(f.o()+1);c=c.K}while(c);return[]}b.length=a.depth;var c=k(a.K,b,d),g=f=a.depth;a=m(q,new e(a));a.U(d);c[f]=b[g]=a;return c}function m(a,b){var d=b.id;return a[d]=a[d]||b}var l=a(d.columnGroups||[]),q={},r={},u=[];this.__rows=this.V=b.computed(function(){var a=f.h.i(),d=0;a.forEach(function(a){a=l[a.id];d=Math.max(d,a?a.depth+a.Ia:0)});u.length=d+1;for(var c=0;c<u.length;++c)u[c]=
u[c]||b.observableArray(),u[c].__rowId="header-row-"+c,u[c].valueWillMutate(),u[c]().length=0;var e=[];a.forEach(function(a){var b=l[a.id],c=b?b.depth+b.height:0;e.length=c;var f=m(r,new g(a));f.U(d-c+1);u[c]().push(f);a=k(b,e,a);for(b=0;b<a.length;++b)a[b]&&u[b]().push(a[b])});u.forEach(function(a){a.valueHasMutated()});return u});this.all=this.all=b.computed(function(){var a=[];this.V().forEach(function(b){Array.prototype.push.apply(a,b())});return a}.bind(this));this.forColumn=this.xa=function(a){a=
"column-header-"+a.id;if(!Object.prototype.hasOwnProperty.call(r,a))throw Error("There is no header for the given column.");return r[a]};var t=new h(function(a,d){return[a,b.contextFor(d).header()]});this.__handleClick=function(a,b){t.fa(".ko-grid-column-header, .ko-grid-column-group-header").Y(b);return!b.defaultPrevented};this.Ha=t.q.bind(t);this.Ga=function(a,b){function d(a,c){c instanceof g&&b.apply(this,arguments)}var c=1<arguments.length;b=c?b:a;t.q.apply(t,c?[a,d]:[d])};this.onHeaderClick=
this.Ha;this.onColumnHeaderClick=this.Ga;this.u=function(){this.V.dispose();this.all.dispose()}.bind(this)}}}(r,t,x,'<thead class="ko-grid-thead" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    \x3c!--before:headers--\x3e\n    <tr class="ko-grid-tr ko-grid-headers"\n        data-bind="indexedRepeat: { forEach: headers.__rows, indexedBy: \'__rowId\', as: \'headerRow\' }"\n        data-repeat-bind="click: headers.__handleClick">\n\n        <th class="ko-grid-th"\n            data-bind="indexedRepeat: { forEach: headerRow(), indexedBy: \'id\', as: \'header\' }"\n            data-repeat-bind="__gridHeader: header"></th>\n    </tr>\n    \x3c!--after:headers--\x3e\n</thead>');
D=function(b,l,h,k,g){b=b.bindingHandlers.grid=b.bindingHandlers.grid||{};return b.core=b.core||{columns:l,data:h,headers:k,layout:g}}(r,H,y,I,function(b){function l(b,a,d,c){var f=b.element,g=f.querySelector(".ko-grid-table-scroller-padding"),h=f.querySelector(".ko-grid-table-scroller"),n=f.querySelector(".ko-grid-thead"),l=f.querySelector(".ko-grid-tfoot"),p=!1;return function(b){if(!p)try{a(p=!0);var e=h.scrollLeft;b&&b();d.forEach(function(a){a.call(f)});k(f,function(){g.style.borderTopWidth=
Math.max(n.clientHeight,0)+"px";g.style.borderBottomWidth=Math.max(l.clientHeight,0)+"px"});h.scrollLeft=e;c.forEach(function(a){a.call(f)})}finally{a(!1),p=!1}}}function h(b){b=b.element;var a=b.querySelector(".ko-grid-table-scroller"),d=b.querySelector(".ko-grid-thead"),c=b.querySelector(".ko-grid-tfoot");a.addEventListener("scroll",function(){var b=-a.scrollLeft+"px";d.style.left=b;c.style.left=b})}function k(b,a){if(b.offsetWidth&&b.offsetHeight)a();else{var d=b.parentNode,c=g.createComment("placeholder");
d.replaceChild(c,b);var f=b.style.position;b.style.position="absolute";b.style.visibility="hidden";g.body.appendChild(b);try{a()}finally{d.replaceChild(b,c),b.style.position=f,b.style.visibility="visible"}}}var g=window.document;return{e:function(){},r:function(e,a,d){function c(a){a&&a()}var f=b.observable(!1);this.recalculate=this.Ma=function(a){c(a)};var k=b.computed(function(){f()||(d.h.i().forEach(function(a){a.width()}),c())}),m=[],n=[];this.ma=function(a){m.push(a)};this.la=function(a){n.push(a)};
this.beforeRelayout=this.ma;this.afterRelayout=this.la;this.A=function(){h.call(this,d);c=l(d,f,m,n);d.da(c)}.bind(this);this.determineCellDimensions=this.ta=function(a){var b=g.createElement("div");b.className="ko-grid-td ko-grid-cell";b.appendChild("string"===typeof a?g.createTextNode(a):a);b.style.position="absolute";b.style.visibility="hidden";g.body.appendChild(b);try{return{width:b.offsetWidth,height:b.offsetHeight}}finally{g.body.removeChild(b)}};this.u=function(){k.dispose()}}}}(r));(function(b,
l){function h(a,b){if(l.c.p(e,a))throw Error("Extension id or alias already in use: `"+a+"`.");e[a]=b;b.T.push(a);return b}function k(a,b){this.La=a;this.sa=b.dependencies||[];this.ub=b.initializer||function(){};this.r=b.Constructor;this.T=[]}var g=b.bindingHandlers.grid=b.bindingHandlers.grid||{},e=g.extensions=g.extensions||{};g.defineExtension=g.lb=function(a,b){return h(a,new k(a,b))};g.O=function(a){if(!l.c.p(e,a))throw Error("No known extension id or alias: `"+a+"`.");return e[a]};g.declareExtensionAlias=
g.jb=function(a,b){return h(a,g.O(b))};g.declareExtensionAliases=g.kb=function(a,b){var c=g.O(b);a.forEach(function(a){return h(a,c)});return c};k.prototype={get vb(){return this.T.slice()},wa:function(a,b){var c=this.ja(a,function(a){throw Error("Conflicting configurations "+a.map(function(a){return"`"+a+"`"}).join(", ")+" (configuration: `"+b+"`).");});if(!c)throw Error("The extension `"+this.La+"` must be configured (configuration: `"+b+"`)");return a[c]},Jb:function(a){var b=this.ja(a,function(a){throw Error("Conflicting binding values "+
a.map(function(a){return"`"+a+"`"}).join(", ")+".");});return a[b]},ja:function(a,b){var c=this.T.filter(function(b){return l.c.p(a,b)});1<c.length&&b(c);return c[0]}};return e})(r,t);return function(b){return b}(function(b,l,h,k){function g(a,c){function e(){var b=m[a];c(b.gb,b.Ib,b.ob)}m[a]?e():b([a],function(b){function c(e){e=d.O(e);var f=e.La,m=e.wa(k,a);if(!h.f.contains(l,f)){if(h.f.contains(u,f))throw Error("Dependency cycle: .. -> "+u.join(" -> ")+" -> "+f+" -> ..");u.push(f);e.sa.forEach(c);
e.ub(g,m,b);l.push(u.pop())}}var g=new G('<div class="ko-grid">\n    \x3c!--before:grid--\x3e\n    <div class="ko-grid-table-container">\n        \x3c!--before:table--\x3e\n        <div class="ko-grid-table-scroller-padding">\n            <div class="ko-grid-table-scroller">\n                <table class="ko-grid-table" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n                    \x3c!--columns--\x3e\n                    \x3c!--head--\x3e\n                    <tfoot class="ko-grid-tfoot" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\x3c!--tfoot--\x3e</tfoot>\n                    \x3c!--body--\x3e\n                </table>\n            </div>\n        </div>\n        \x3c!--after:table--\x3e\n    </div>\n    \x3c!--after:grid--\x3e\n</div>');
f.forEach(function(a){a.e(g,b)});var k=b.extensions||{},l=[],u=[];Object.keys(k).forEach(c);var t="ko-grid-template-"+a;q.b(t,g.cb());m[a]={gb:b,Ib:t,ob:l};e()})}function e(a,b){this.bb=b;this.primaryKey=this.primaryKey=b.primaryKey;this.rootElement=a;this.element=this.element=null;this.u=function(){};this.l=function(){};this.postApplyBindings=this.da=function(a){if(!this.l)throw Error("Illegal state: postApplyBindings-callbacks have been called already.");var b=this.l;this.l=function(){b();a()}}.bind(this);
var d=new k;this.b=d.q.bind(d);this["onKeyDown "]=this.b;a.addEventListener("keydown",function(a){d.fa(".ko-grid").Y(a);return!a.defaultPrevented})}var a=window.document,d=l.bindingHandlers.grid=l.bindingHandlers.grid||{},c=["columns","headers","data","layout"],f=c.map(function(a){return D[a]}),q=new l.nativeTemplateEngine;q.b=function(b,d){var c=a.createElement("script");c.id=b;c.type="text/html";c.text=d;a.querySelector("head").appendChild(c)};l.bindingHandlers.grid.init=function(a,b,f,k,m){function t(a){return"function"===
typeof a?a.apply(void 0,Array.prototype.slice.call(arguments,1)):a}var r=b(),x=r.config;g(x,function(b,f,g){var k=[],p=new e(a,r);l.utils.domNodeDisposal.addDisposeCallback(a,function(){p.u();k.forEach(function(a){a()})});h.c.aa(D,function(a,d){var c=new d.r(r,b,p);p[a]=c;p.h=p.columns;p.headers=p.headers;p.data=p.data;p.k=p.layout;"function"===typeof c.u&&k.push(c.u.bind(c))});var w=b.extensions,B=r.extensions||{},y=p.extensions=p.pb={};for(g.forEach(function(a){a=d.O(a);var c=a.Jb(B)||{},e=t(a.wa(w,
x),c,r);if((!1!==e.enabled||!0===c.enabled)&&!1!==c.enabled){a.sa.forEach(function(a){if(!y[a])throw Error("Dependency '"+a+"' was disabled.");});var f=new a.r(c,e,p,r,b);a.vb.forEach(function(a){y[a]=f});"function"===typeof f.dispose&&k.push(f.dispose.bind(f))}});a.firstChild;)l.removeNode(a.firstChild);g=m.createChildContext(p,"grid");l.renderTemplate(f,g,{templateEngine:q},a);var C=a.querySelector(".ko-grid");p.element=C;p.element=C;h.c.aa(w,function(a){C.className+=" with-"+h.H.ra(a)});c.forEach(function(a){p[a].A&&
p[a].A()});p.l();p.l=null});return{controlsDescendantBindings:!0}};l.bindingHandlers.grid.update=function(){};var m={};l.bindingHandlers._gridWidth={init:function(){},update:function(a,b){var c=b();a.style.width=c;a.style.maxWidth=c}};return d}(B,r,t,x))});