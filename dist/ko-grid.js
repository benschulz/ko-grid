/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
(function(x){"function"===typeof define&&define.amd?define(["require","knockout","ko-data-source","ko-indexed-repeat"],x):window["ko-grid"]=x(function(r,t){if(!Array.isArray(r)||1!==r.length||"string"!==typeof r[0]||"function"!==typeof t)throw Error("Assertion error.");var x=window.ko.bindingHandlers.grid.config=window.ko.bindingHandlers.grid.config||{};t(x[r[0]])},window.ko)})(function(x,r){var t,C,D,w,y,A;t=function(){var b;b=function(){function b(f,k){return Object.prototype.hasOwnProperty.call(f,
k)}return{Ta:function(b,f){if(b===f)return!0;var h=!!f&&"function"===typeof f.valueOf;return!!b&&"function"===typeof b.valueOf&&h&&b.valueOf()===f.valueOf()},extend:function(b,f){Array.prototype.slice.call(arguments,1).forEach(function(h){for(var d=Object.keys(h),a=0,c=d.length;a<c;a++){var e=d[a],l=Object.getOwnPropertyDescriptor(h,e);void 0!==l&&l.enumerable&&Object.defineProperty(b,e,l)}});return b},ba:function(n,k){for(var h in n)b(n,h)&&k(h,n[h])},A:b,qb:function(n,k){var h={},d;for(d in n)b(n,
d)&&(h[d]=k(n[d],d,n));return h}}}();return function(b){return b}(function(b,n,k,h){return{f:b,b:n,d:k,L:h}}(function(b){function n(a){return a.filter(function(a,e,l){return l.lastIndexOf(a)===e})}function k(a,c){for(var e=a.length,l=-1,b=0;b<e;++b)if(c(a[b])){if(0<=l)throw Error("Multiple elements match the predicate.");l=b}return l}function h(a,c){return a&&"function"===typeof a.valueOf&&c&&"function"===typeof c.valueOf?a.valueOf()<=c.valueOf()?a.valueOf()<c.valueOf()?-1:0:1:a<=c?a<c?-1:0:1}function d(a,
c){var e=a.length,b=Array(e),d=Array(e),g;for(g=0;g<e;++g)b[g]=g,d[g]=a[g];g=a;a=d;d=g;b.sort(function(m,p){return c(a[m],a[p])||m-p});for(g=0;g<e;++g)d[g]=a[b[g]];return d}return{contains:function(a,c){return 0<=a.indexOf(c)},eb:function(a){if(50<a.length){for(var c=a.length,e={},l,d=0;d<c;++d)if(l=a[d],"string"===typeof l)if(b.A(e,l))break;else e[l]=!0;else if(a.lastIndexOf(l)!==d)break;if(!(d>=c)){for(var g=a.slice(0,d);d<c;++d)l=a[d],"string"===typeof l?b.A(e,l)||(e[l]=!0,g.push(l)):a.lastIndexOf(l)===
d&&g.push(l);a=g}}else a=n(a);return a},aa:function(a,c){return Array.prototype.concat.apply([],a.map(c))},yb:function(a,c){var e=k(a,c);if(0>e)throw Error("None of the elements matches the predicate.");return a[e]},zb:function(a,c){var e=k(a,c);return 0<=e?a[e]:null},La:function(a,c){var e=c||h;window.chrome?e=d(a,e):(a.sort(e),e=a);return e}}}(b),function(){function b(f){return function(){return f}}return{Ob:b(!0),Jb:b(!1),h:b(void 0),Nb:b(null),Pb:b(0),Ya:b,wa:function(b){return b}}}(),b,{qa:function(b){return b.replace(/([A-Z])/g,
function(b){return"-"+b.toLowerCase()})},Za:function(b){return b.replace(/-([a-z])/g,function(b){return b[1].toUpperCase()})},format:function(b){var n=arguments;return b.replace(/{(\d+)}/g,function(b,h){var d=parseInt(h,10)+1;return typeof n.length<=d?b:n[d]})}}))}();C=function(){var b=/^[a-z]+(-[a-z]+)*$/,f=/\x3c!--(?:(before|after):)?([a-z]+(-[a-z]+)*)--\x3e*/g;return function(n){function k(b,c){c=c||function(a,m){return m+a};return function(g){var m=h(g,b);return{O:function(p,q){var b=q?p:null,
g=(q=q?q:p)?b:null,l=q,b=c;g&&a(g,2);d(l);g=g?h(g,3)+l+h(g,4):l;b=b(m,g);e=e.replace(m,b)}}}}function h(a,b){function g(p){if(c[a]!==p)throw Error("Operation is not defined for placeholder `"+a+"`.");}if(!c[a])throw Error("Unknown placeholder id `"+a+"`.");var m="\x3c!--"+a+"--\x3e",p="\x3c!--before:"+a+"--\x3e",q="\x3c!--after:"+a+"--\x3e";switch(b){case 1:return g(1),delete c[a],m;case 2:return g(1),m;case 3:return g(2),p;case 4:return g(2),q;case 5:case 6:return 1===c[a]?m:5===b?q:p}throw Error("Assertion error. Unkown operator: `"+
b+"`");}function d(b){for(var c;c=f.exec(b);){var g=c[1],m="before"===g;c=c[2];if(g&&1!==(b.match(new RegExp((m?"after":"before")+":"+c,"g"))||[]).length)throw Error("Multiple or unmatched before-/after-placeholders for placeholder id `"+c+"`.");g&&!m||a(c,g?2:1)}}function a(a,e){if(!b.test(a))throw Error("Invalid placeholder id `"+a+"`");if(c[a])throw Error("Placeholder id `"+a+"` is already taken.");c[a]=e}var c={},e=n;d(e);this.replace=function(a){return{fa:k(1,function(a,b){return b})(a).O}};
this.Ma=function(a){return{append:k(5)(a).O,Fa:k(6,function(a,b){return a+b})(a).O}};this.Ua=function(){return e.replace(f,"")}}}();D=function(b,f,n){function k(b){return null===b?"":""+b}function h(d,a,c){this.id=this.id=c.id;this.property=this.da=c.property||this.id;this.userDefined=this.ea=!1!==c.ea;this.n=!c.hidden;this.visible=this.visible;this.label=this.label=b.observable(c.label);this.width=this.width=b.observable(c.width);this.widthInPixels=this.S=function(){var a=this.width();if("px"!==
a.substr(-2))throw Error("The only currently supported column width values are absolute pixel lengths.");return parseInt(a.substring(0,a.length-2),10)}.bind(this);this.va=b.observableArray(c.headerClasses||c.classes||[]);this.oa=b.observableArray(c.cellClasses||c.classes||[]);this.g=b.observableArray(c.footerClasses||c.classes||[]);this.headerClasses=this.va;this.cellClasses=this.oa;this.footerClasses=this.g;this.metadata=this.na=a.columnMetadataProvider?a.columnMetadataProvider(d,c):{};this.renderValue=
this.J=a.cellValueRenderer?a.cellValueRenderer.bind(void 0,this):k;this.ra=function(a){this.J=a(this.J)}.bind(this);this.G=function(a){a=a({q:this.u,update:this.ja});if(!a||!a.q||!a.update)throw Error("The cell value binding must define an `init` as well as an `update` method.");this.u=a.q;this.ja=a.update}.bind(this);this.overrideValueRendering=this.ra;this.overrideValueBinding=this.G}b.bindingHandlers.__gridColumn={init:f.b.h,update:function(b,a){var c=a();b.style.width=c.width()}};return{q:function(b){b.replace("columns").fa(n)},
m:function(d,a,c){function e(b){b=new h(c,a,b);a.columnInitializer&&a.columnInitializer(b);return b}var l=[];this.all=this.all=b.observableArray(d.columns.map(e));this.byId=this.ma=function(a){var b=this.Na(a);if(!b)throw Error("The column id `"+a+"` is undefined.");return b}.bind(this);this.tryById=this.Na=function(a){var b=this.all().filter(function(b){return b.id===a});if(1<b.length)throw Error("Assertion error: Multiple columns with id `"+a+"`.");return b[0]}.bind(this);var f=b.observable(this.all().filter(function(a){return a.n}));
this.displayed=this.j=function(){return f()};this.show=function(a){this.K(function(b){return b.n||b===a})}.bind(this);this.jb=function(a){this.K(function(b){return b.n&&b!==a})}.bind(this);this.show=this.show;this.hide=this.jb;this.reorder=this.xb=function(a){var b=this.all().slice(),p=[];a.forEach(function(a){b.splice(b.indexOf(a),1);p.push(a)});if(b.length)throw Error("The new column order must contain all columns.");this.all(p);this.K(function(a){return a.n})}.bind(this);this.showOnlyThoseWhich=
this.K=function(a){var b=this.all();a=b.filter(a);b.forEach(function(a){a.n=!1});a.forEach(function(a){a.n=!0});f(a)}.bind(this);this.combinedWidth=this.Wa=b.pureComputed(function(){for(var a=0,b=this.j(),p=0;p<b.length;++p)a+=b[p].S();return a}.bind(this));this.add=this.add=function(a){a=e({ea:!1,id:"$"+a.id,label:a.label,hidden:a.hidden||!1,width:a.width});this.all.unshift(a);this.K(function(a){return a.n});return a}.bind(this);this.o=function(){l.forEach(function(a){a.dispose()})}}}}(r,t,'<colgroup class="ko-grid-colgroup">\n    <col class="ko-grid-col" data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\' }" data-repeat-bind="__gridColumn: column()">\n</colgroup>');
w=function(b){var f,n,k;f=function(b){return function(d,a){return b.d.extend(d,{get stringifyable(){return a()}})}}(b);n=function(b,d){function a(){return 0}function c(a,b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function e(a,c){b.d.extend(a,{get onResultOf(){return this.I},get reverse(){return this.reverse},get callable(){return this.H}},{get I(){return function(b){return l(b,a)}},get reverse(){return function(){return c||f(a)}},get H(){return a}})}function l(a,
b){function p(p,c){return b(a(p),a(c))}e(p);d(p,function(){return{type:"by-function-comparator",ib:a.stringifyable,M:b.stringifyable}});return p}function f(a){function b(p,c){return-a(p,c)}e(b,a);d(b,function(){return{type:"reversed-comparator",M:a.stringifyable}});return b}e(c);d(c,function(){return{type:"natural-comparator"}});e(a);d(a,function(){return{type:"indifferent-comparator"}});return{lb:a,g:c}}(b,f);k=function(b,d){function a(a){b.d.extend(a,{get callable(){return this.H}},{get H(){return a}})}
return{wb:function(b){function e(a){return a[b]}a(e);d(e,function(){return{type:"property-accessor",propertyName:b}});return e}}}(b,f);b=function(b,d){function a(){return!0}function c(){return!1}function e(a,c){b.d.extend(a,{get and(){return this.F},get negate(){return this.Aa},get onResultOf(){return this.I},get or(){return this.Q},get callable(){return this.H}},{get F(){return function(b){return l([a,b])}},get Aa(){return function(){return c||g(a)}},get I(){return function(b){return f(b,a)}},get Q(){return function(b){return m([a,
b])}},get H(){return a}})}function l(b){function c(a){for(var q=0,m=b.length;q<m;++q)if(!b[q](a))return!1;return!0}if(!b.length)return a;e(c);d(c,function(){return{type:"and-predicate",components:b.map(function(a){return a.stringifyable})}});return c}function f(a,b){function c(m){return b(a(m))}e(c);d(c,function(){return{type:"by-function-predicate",ib:a.stringifyable,R:b.stringifyable}});return c}function g(a){function b(c){return!a(c)}e(b,a);d(b,function(){return{type:"negated-predicate",R:a.stringifyable}});
return b}function m(a){function b(c){for(var m=0,q=a.length;m<q;++m)if(a[m](c))return!0;return!1}if(!a.length)return c;e(b);d(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}e(c);d(c,function(){return{type:"always-false-predicate"}});e(a);d(a,function(){return{type:"always-true-predicate"}});return{g:c,G:a,F:l,na:function(a,b){function c(b){return a(b)}e(c);d(c,b);return c},Q:m,Ia:function(a){function b(c){return a.test(c)}e(b);d(b,function(){return{type:"regular-expression-predicate",
Ia:a.source,Ib:!a.ignoreCase,multiline:a.multiline}});return b}}}(b,f);return function(b){return b}({v:n,b:k,e:b,pb:f,Bb:function(b,d){return"function"===typeof d||"object"===typeof d?d.stringifyable||d:d}})}(t);y=function(b,f){function n(h){var d=h.defaultPrevented;b.d.extend(this,h,{preventDefault:function(){d=!0;return h.preventDefault()},ra:function(){d=!0},get defaultPrevented(){return d}})}function k(b,d){this.ca=b;this.Ka=d}return function(h){function d(c,e,d){function h(a){a=Array.prototype.slice.call(c.querySelectorAll(a)).filter(function(a){return f.ya(a,
e.target)});return a.length?a[a.length-1]:void 0}var g=f.sa.bind(null,c),m=a.map(function(a){var b=a.Ka?h(a.Ka):c;return{ca:a.ca,match:b,depth:b?g(b):-1}}).filter(function(a){return!!a.match});b.f.La(m,function(a,b){return b.depth-a.depth});m.forEach(function(a){a.ca.apply(c,d)})}h=h||function(a){return[a]};var a=[];this.B=function(b,e){var d=1<arguments.length?b:void 0;e=1<arguments.length?e:b;a.push(new k(e,d))};this.Ja=function(a){return{ta:function(b){var l=f.element.pa(b.target,a);l&&(b=new n(b),
d(l,b,h(b,l)))}}}}}(t,function(){return function(b){return b}(function(){function b(b,h){return!!(b.compareDocumentPosition(h)&16)}var f=window.Element,n=f.prototype.webkitMatchesSelector||f.prototype.mozMatchesSelector||f.prototype.msMatchesSelector||f.prototype.matches;return{sa:function(b,h){for(var d=0;h;){if(h===b)return d;h=h.parentNode;++d}throw Error("The given node is not part of the subtree.");},ya:function(f,h){return f===h||b(f,h)},Ab:b,element:{pa:function(b,f){do{if(n.call(b,f))return b;
b=b.parentElement}while(b);return null},matches:function(b,f){return n.call(b,f)}}}}())}());w=function(b,f,n,k,h){function d(a){this.l(function(b){b();this.t=a.element.querySelector(".ko-grid-tbody")}.bind(this));return function(){this.t=null}.bind(this)}function a(){var a=[],c={};this.rows=this.rows=c;c.j=b.observableArray([]);c.displayed=c.j;c.$=b.observable(!1).extend({Mb:"always"});c.displayedSynchronized=c.$;c.__handleDisplayedRowsDeviate=function(){this.rows.$(!1)}.bind(this);c.__handleDisplayedRowsSynchronized=
function(){this.rows.$(!0)}.bind(this);var q=this.view;c.__dirty=q.dirty;a.push(q.observables.subscribe(function(a){c.j(a)}));c.j(q.observables());var d=[];c.__classify=function(a){var b=d.map(function(b){return b(a)});return Array.prototype.concat.apply([],b)};c.mb=function(a){d.push(a)};c.installClassifier=c.mb;return function(){a.forEach(function(a){a.dispose()})}}function c(){function a(c,m){var d=b.contextFor(m),q=d.row(),d=d.column();return[c,q[d.da],q,d]}function c(a){return function(b){a.Ja(".ko-grid-cell").ta(b);
return!b.defaultPrevented}}var q=new k(a),d=new k(a),e=new k(a),g=new k(a);this.vb=q.B.bind(q);this.sb=d.B.bind(d);this.ub=e.B.bind(e);this.tb=g.B.bind(g);this["onCellMouseDown "]=this.vb;this["onCellClick "]=this.sb;this["onCellDoubleClick "]=this.ub;this["onCellContextMenu "]=this.tb;this.l(function(a){a();this.t.addEventListener("mousedown",c(q));this.t.addEventListener("click",c(d));this.t.addEventListener("dblclick",c(e));this.t.addEventListener("contextmenu",c(g))}.bind(this));return f.b.h}
function e(a){function c(a,b){for(var d=a.firstChild,m=-1;d;){if(d.nodeType===v&&"TD"===d.tagName&&0<=(" "+d.className+" ").indexOf("td")&&++m===b)return d;d=d.nextSibling}throw Error("Column `"+b+"` does not exist.");}var d=function(a){for(var b=this.t.firstChild,c=-1;b;){if(b.nodeType===v&&"TR"===b.tagName&&0<=(" "+b.className+" ").indexOf("ko-grid-row")&&++c===a)return b;b=b.nextSibling}throw Error("Row `"+a+"` does not exist.");}.bind(this);this.lookupCell=this.ob=function(e,f){var h=this.rows.j().indexOf(e),
n=a.i.j().indexOf(f),k=c(d(h),n);return{element:k,hijack:function(a){function c(){for(k.removeAttribute("data-hijacked");k.firstChild;)b.removeNode(k.firstChild);var a=b.contextFor(k).row();f.u?f.u(k,a,f):k.appendChild(g.createTextNode(""));l(k,a(),f)}if(k.hasAttribute("data-hijacked"))throw Error("Illegal state: This cell is already hijacked.");for(;k.firstChild;)b.removeNode(k.firstChild);k.className+=" "+a;k.setAttribute("data-hijacked","hijacked "+a);return{dispose:c,release:c}}}}.bind(this);
return f.b.h}function l(a,c,d){var e=c[d.da],g=e&&b.unwrap(e),f=a.getAttribute("data-hijacked"),l=d.oa.peek().join(" ");a.className="ko-grid-td ko-grid-cell "+l+(f?" "+f:"");f||(d.u?d.ja(a,e,c,d):a.lastChild.nodeValue=d.J(g))}var v=window.Node.ELEMENT_NODE,g=window.document;b.bindingHandlers.__gridRow={init:f.b.h,update:function(a,b){var c=b(),d=c.classify,e=c.row(),c=1===c.index()%2?["ko-grid-tr","ko-grid-row","alternate"]:["ko-grid-tr","ko-grid-row"],d=d(e);a.className=c.concat(d).join(" ")}};b.bindingHandlers.__gridCell=
{init:function(a,c){for(var d=c(),e=d.row,d=d.column,f=d();a.firstChild;)b.removeNode(a.firstChild);f.u?f.u(a,e,d):a.appendChild(g.createTextNode(""));return{controlsDescendantBindings:!0}},update:function(a,b){var c=b(),d=c.row(),c=c.column.peek();l(a,d,c)}};return{q:function(a){a.replace("body").fa("body",h);a.Ma("table").Fa("<div class=\"ko-grid-load-indicator\" data-bind=\"style: { display: data.rows.__dirty() ? 'block' : 'none' }\">Loading&hellip;</div>")},m:function(m,g,q){var l=[];this.source=
m.dataSource;this.valueSelector=this.Oa=m.valueSelector||g.valueSelector||f.b.wa;this.observableValueSelector=this.rb=m.observableValueSelector||g.observableValueSelector||this.Oa;this.predicates=this.e=b.observableArray(m.filters||[]);this.predicate=this.R=b.pureComputed(function(){return n.e.F(this.e().map(b.unwrap))}.bind(this));this.comparator=this.M=b.observable(n.v.lb);this.offset=this.offset=b.observable(0);this.limit=this.za=b.observable(Number.POSITIVE_INFINITY);m=this.source.openView(function(a){return a.filteredBy(this.R).sortedBy(this.M).offsetBy(this.offset).limitedTo(this.za)}.bind(this));
l.push(m.dispose.bind(m));this.view=this.view=m;this.D=f.b.h;this.l=function(a){var b=this.D;this.D=function(){a(b)}}.bind(this);l.push(d.call(this,q));l.push(a.call(this));l.push(c.call(this));l.push(e.call(this,q));this.o=function(){l.forEach(function(a){a()})}}}}(r,t,w,y,'<tbody class="ko-grid-tbody" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    <tr class="ko-grid-tr ko-grid-row"\n        data-bind="indexedRepeat: {\n            forEach: data.rows.displayed,\n            indexedBy: function(r) { return grid.data.observableValueSelector(ko.unwrap(r[grid.primaryKey])); },\n            as: \'row\',\n            at: \'rowIndex\',\n            allowDeviation: true,\n            onDeviation: data.rows.__handleDisplayedRowsDeviate,\n            onSynchronization: data.rows.__handleDisplayedRowsSynchronized }"\n        data-repeat-bind="__gridRow: { classify: grid.data.rows.__classify, row: row, index: rowIndex }">\n\n        <td data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\', allowElementRecycling: false }"\n            data-repeat-bind="__gridCell: { row: row, column: column }"></td>\n    </tr>\n</tbody>');
y=function(b,f,n,k){function h(a){this.id=this.id="column-header-"+a.id;this.element=this.element=b.observable(null);this.rowSpan=this.rowSpan=b.observable(1);this.columnSpan=this.p=b.observable(1);this.label=this.label=a.label;this.column=this.Y=a;this.columns=this.i=[a];this.W=function(a){this.rowSpan(a)}.bind(this)}function d(a){this.id=this.id="column-group-header-"+(a.id||"@__"+ ++g);this.element=this.element=b.observable(null);this.Sa=a;this.rowSpan=this.rowSpan=b.observable(a.height);this.columnSpan=
this.p=b.observable(1);this.label=this.label=b.observable(a.label);this.columns=this.i=[];this.W=function(a){this.i=[a];this.p(1)}.bind(this)}function a(a){function b(a){a.Va.forEach(function(b){var c=d[b];if(!c)d[b]=a;else if(c!==a)throw Error("Column `"+b+"` is element of column group `"+c.label+"` as well as `"+a.label+"`.");});a.N&&b(a.N)}var d={};f.f.aa(a,c.bind(this,null)).forEach(function(a){b(a)});return d}function c(a,b){var d=e(b),g=b.elements.filter(function(a){return"string"!==typeof a}),
l=b.elements.filter(function(a){return"string"===typeof a}),d={id:b.id,label:b.label,N:a,depth:a?a.depth+1:0,height:a?a.Da-d:1,Da:d,Va:l};return g.length?f.f.aa(g,c.bind(this,d)):d}function e(a){a=a.elements.filter(function(a){return"string"!==typeof a});return 1+Math.max.apply(Math,[0].concat(a.map(e)))}var l=window.document,v=window.Node,g=0;b.bindingHandlers.__gridHeader={init:function(a,c){var d=c()();d.element(a);b.utils.domNodeDisposal.addDisposeCallback(a,function(){d.element(null)});for(var e=
a.firstChild;e;){var g=e;g.nodeType===v.TEXT_NODE&&b.removeNode(g);e=e.nextSibling}a.insertBefore(l.createTextNode(""),a.firstChild);return{controlsDescendantBindings:!0}},update:function(a,b){var c=b()(),d=c.id.replace(/[\s]/g,"_");a.className=c.Y?"ko-grid-th ko-grid-column-header "+d+" "+c.Y.va().join(" "):"ko-grid-th ko-grid-column-group-header "+d;d=c.i.map(function(a){return a.S()}).reduce(function(a,b){return a+b})+"px";a.style.width=d;a.style.maxWidth=d;a.rowSpan=c.rowSpan();a.colSpan=c.p();
for(d=a.firstChild;d.nodeType!==v.TEXT_NODE;)d=d.nextSibling;d.nodeValue=c.label()}};return{q:function(a){a.replace("head").fa(k)},m:function(c,e,g){function f(a,b,c){if(!a)return[];if(b[a.depth]&&b[a.depth].Sa===a){var e=a;do{var g=b[e.depth];g.i.push(c);g.p(g.p()+1);e=e.N}while(e);return[]}b.length=a.depth;var e=f(a.N,b,c),h=g=a.depth;a=l(v,new d(a));a.W(c);e[g]=b[h]=a;return e}function l(a,b){var c=b.id;return a[c]=a[c]||b}var k=a(c.columnGroups||[]),v={},r={},u=[];this.__rows=this.X=b.computed(function(){var a=
g.i.j(),c=0;a.forEach(function(a){a=k[a.id];c=Math.max(c,a?a.depth+a.Da:0)});u.length=c+1;for(var d=0;d<u.length;++d)u[d]=u[d]||b.observableArray(),u[d].__rowId="header-row-"+d,u[d].valueWillMutate(),u[d]().length=0;var e=[];a.forEach(function(a){var b=k[a.id],d=b?b.depth+b.height:0;e.length=d;var g=l(r,new h(a));g.W(c-d+1);u[d]().push(g);a=f(b,e,a);for(b=0;b<a.length;++b)a[b]&&u[b]().push(a[b])});u.forEach(function(a){a.valueHasMutated()});return u});this.all=this.all=b.computed(function(){var a=
[];this.X().forEach(function(b){Array.prototype.push.apply(a,b())});return a}.bind(this));this.forColumn=this.hb=function(a){a="column-header-"+a.id;if(!Object.prototype.hasOwnProperty.call(r,a))throw Error("Es existiert kein Header f\u00fcr die gegebene Spalte.");return r[a]};var z=new n(function(a,c){return[a,b.contextFor(c).header()]});this.__handleClick=function(a,b){z.Ja(".ko-grid-column-header, .ko-grid-column-group-header").ta(b);return!b.defaultPrevented};this.Ca=z.B.bind(z);this.Ba=function(a,
b){function c(a,d){d instanceof h&&b.apply(this,arguments)}var d=1<arguments.length;b=d?b:a;z.B.apply(z,d?[a,c]:[c])};this.onHeaderClick=this.Ca;this.onColumnHeaderClick=this.Ba;this.o=function(){this.X.dispose();this.all.dispose()}.bind(this)}}}(r,t,y,'<thead class="ko-grid-thead" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    \x3c!--before:headers--\x3e\n    <tr class="ko-grid-tr ko-grid-headers"\n        data-bind="indexedRepeat: { forEach: headers.__rows, indexedBy: \'__rowId\', as: \'headerRow\' }"\n        data-repeat-bind="click: headers.__handleClick">\n\n        <th class="ko-grid-th"\n            data-bind="indexedRepeat: { forEach: headerRow(), indexedBy: \'id\', as: \'header\' }"\n            data-repeat-bind="__gridHeader: header"></th>\n    </tr>\n    \x3c!--after:headers--\x3e\n</thead>');
A=function(b,f,n,k,h){b=b.bindingHandlers.grid=b.bindingHandlers.grid||{};return b.core=b.core||{columns:f,data:n,headers:k,layout:h}}(r,D,w,y,function(b,f){function n(a,b,d,f){var k=a.element,g=k.querySelector(".ko-grid-table-scroller-padding"),m=k.querySelector(".ko-grid-table-scroller"),n=k.querySelector(".ko-grid-thead"),q=k.querySelector(".ko-grid-tfoot"),B=!1;return function(a){if(!B)try{b(B=!0);var r=m.scrollLeft;a&&a();d.forEach(function(a){a.call(k)});h(k,function(){g.style.borderTopWidth=
Math.max(n.clientHeight,0)+"px";g.style.borderBottomWidth=Math.max(q.clientHeight,0)+"px"});m.scrollLeft=r;f.forEach(function(a){a.call(k)})}finally{b(!1),B=!1}}}function k(a){a=a.element;var b=a.querySelector(".ko-grid-table-scroller"),d=a.querySelector(".ko-grid-thead"),f=a.querySelector(".ko-grid-tfoot");b.addEventListener("scroll",function(){var a=-b.scrollLeft+"px";d.style.left=a;f.style.left=a})}function h(a,b){if(a.offsetWidth&&a.offsetHeight)b();else{var e=a.parentNode,f=d.createComment("placeholder");
e.replaceChild(f,a);var h=a.style.position;a.style.position="absolute";a.style.visibility="hidden";d.body.appendChild(a);try{b()}finally{e.replaceChild(a,f),a.style.position=h,a.style.visibility="visible"}}}var d=window.document;return{q:f.b.h,m:function(a,c,e){function f(a){a&&a()}var h=b.observable(!1);this.recalculate=this.Ha=function(a){f(a)};var g=b.computed(function(){h()||(e.i.j().forEach(function(a){a.width()}),f())}),m=[],p=[];this.la=function(a){m.push(a)};this.ka=function(a){p.push(a)};
this.beforeRelayout=this.la;this.afterRelayout=this.ka;this.D=function(){k.call(this,e);f=n(e,h,m,p);e.Ea(f)}.bind(this);this.determineCellDimensions=this.cb=function(a){var b=d.createElement("div");b.className="ko-grid-td ko-grid-cell";b.appendChild("string"===typeof a?d.createTextNode(a):a);b.style.position="absolute";b.style.visibility="hidden";d.body.appendChild(b);try{return{width:b.offsetWidth,height:b.offsetHeight}}finally{d.body.removeChild(b)}};this.o=function(){g.dispose()}}}}(r,t));(function(b,
f){function n(a,b){if(f.d.A(d,a))throw Error("Extension id or alias already in use: `"+a+"`.");d[a]=b;b.V.push(a);return b}function k(a,b){this.Ga=a;this.Z=b.Z||[];this.xa=b.xa||f.b.h;this.m=b.m;this.V=[]}var h=b.bindingHandlers.grid=b.bindingHandlers.grid||{},d=h.extensions=h.extensions||{};h.bb=function(a,b){return n(a,new k(a,b))};h.P=function(a){if(!f.d.A(d,a))throw Error("No known extension id or alias: `"+a+"`.");return d[a]};h.$a=function(a,b){return n(a,h.P(b))};h.ab=function(a,b){var d=h.P(b);
a.forEach(function(a){return n(a,d)});return d};k.prototype={get nb(){return this.V.slice()},ua:function(a,b){var d=this.ia(a,function(a){throw Error("Conflicting configurations "+a.map(function(a){return"`"+a+"`"}).join(", ")+" (configuration: `"+b+"`).");});if(!d)throw Error("The extension `"+this.Ga+"` must be configured (configuration: `"+b+"`)");return a[d]},Db:function(a){var b=this.ia(a,function(a){throw Error("Conflicting binding values "+a.map(function(a){return"`"+a+"`"}).join(", ")+".");
});return a[b]},ia:function(a,b){var d=this.V.filter(function(b){return f.d.A(a,b)});1<d.length&&b(d);return d[0]}};return d})(r,t);return function(b){return b}(function(b,f,n){function k(d,c){function f(){var a=r[d];c(a.Xa,a.Cb,a.fb)}r[d]?f():b([d],function(b){function c(e){e=a.P(e);var f=e.Ga,l=e.ua(k,d);if(!n.f.contains(m,f)){if(n.f.contains(t,f))throw Error("Dependency-Cycle: .. -> "+t.join(" -> ")+" -> "+f+" -> ..");t.push(f);e.Z.forEach(c);e.xa(h,l,b);if(t.pop()!==f)throw Error("Assertion error.");
m.push(f)}}var h=new C('<div class="ko-grid">\n    \x3c!--before:grid--\x3e\n    <div class="ko-grid-table-container">\n        \x3c!--before:table--\x3e\n        <div class="ko-grid-table-scroller-padding">\n            <div class="ko-grid-table-scroller">\n                <table class="ko-grid-table" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n                    \x3c!--columns--\x3e\n                    \x3c!--head--\x3e\n                    <tfoot class="ko-grid-tfoot" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\x3c!--tfoot--\x3e</tfoot>\n                    \x3c!--body--\x3e\n                </table>\n            </div>\n        </div>\n        \x3c!--after:table--\x3e\n    </div>\n    \x3c!--after:grid--\x3e\n</div>');
e.forEach(function(a){a.q(h,b)});var k=b.extensions,m=[],t=[];Object.keys(k).forEach(c);var u="ko-grid-template-"+d;l.g(u,h.Ua());r[d]={Xa:b,Cb:u,fb:m};f()})}function h(a,b){this.primaryKey=this.g=b.primaryKey;this.rootElement=a;this.element=this.element=null;f.observableArray([]);this.l=this.o=n.b.h;this.Ea=function(a){if(!this.l)throw Error("Illegal state: postApplyBindings-callbacks have been called already.");var b=this.l;this.l=function(){b();a()}}.bind(this)}var d=window.document,a=f.bindingHandlers.grid=
f.bindingHandlers.grid||{},c=["columns","headers","data","layout"],e=c.map(function(a){return A[a]}),l=new f.nativeTemplateEngine;l.g=function(a,b){var c=d.createElement("script");c.id=a;c.type="text/html";c.text=b;d.querySelector("head").appendChild(c)};f.bindingHandlers.grid.init=function(b,d,e,q,r){var t=d(),v=t.config;k(v,function(d,e,k){var m=[],p=new h(b,t);f.utils.domNodeDisposal.addDisposeCallback(b,function(){p.o();m.forEach(function(a){a()})});n.d.ba(A,function(a,b){var c=new b.m(t,d,p);
p[a]=c;p.i=p.columns;p.headers=p.headers;p.data=p.data;p.G=p.layout;"function"===typeof c.o&&m.push(c.o.bind(c))});var q=d.extensions,x=t.extensions||{},y=p.extensions=p.gb={};for(k.forEach(function(b){b=a.P(b);var c=b.ua(q,v),e=b.Db(x)||{};if((!1!==c.enabled||!0===e.enabled)&&!1!==e.enabled){b.Z.forEach(function(a){if(!y[a])throw Error("Dependency '"+a+"' was disabled.");});var f=new b.m(e,c,p,t,d);b.nb.forEach(function(a){y[a]=f});"function"===typeof f.dispose&&m.push(f.dispose.bind(f))}});b.firstChild;)f.removeNode(b.firstChild);
k=r.createChildContext(p,"grid");f.renderTemplate(e,k,{templateEngine:l},b);var w=b.querySelector(".ko-grid");p.element=w;p.element=w;n.d.ba(q,function(a){w.className+=" with-"+n.L.qa(a)});c.forEach(function(a){p[a].D&&p[a].D()});p.l();p.l=null});return{controlsDescendantBindings:!0}};f.bindingHandlers.grid.update=n.b.h;var r={};f.bindingHandlers._gridWidth={init:n.b.h,update:function(a,b){var c=b();a.style.width=c;a.style.maxWidth=c}};return a}(x,r,t))});