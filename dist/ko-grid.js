/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
(function(w){"function"===typeof define&&define.amd?define(["require","knockout","ko-data-source","ko-indexed-repeat"],w):window["ko-grid"]=w(function(r,t){if(!Array.isArray(r)||1!==r.length||"string"!==typeof r[0]||"function"!==typeof t)throw Error("Assertion error.");var w=window.ko.bindingHandlers.grid.config=window.ko.bindingHandlers.grid.config||{};t(w[r[0]])},window.ko)})(function(w,r){var t,C,D,x,E,A;t=function(){var a;a=function(){function a(m,d){return Object.prototype.hasOwnProperty.call(m,
d)}return{f:function(a,d){if(a===d)return!0;var l=!!d&&"function"===typeof d.valueOf;return!!a&&"function"===typeof a.valueOf&&l&&a.valueOf()===d.valueOf()},extend:function(a,d){Array.prototype.slice.call(arguments,1).forEach(function(d){for(var p=Object.keys(d),b=0,c=p.length;b<c;b++){var f=p[b],g=Object.getOwnPropertyDescriptor(d,f);void 0!==g&&g.enumerable&&Object.defineProperty(a,f,g)}});return a},V:function(m,q){for(var l in m)a(m,l)&&q(l,m[l])},r:a,F:function(m,q){var l={},p;for(p in m)a(m,
p)&&(l[p]=q(m[p],p,m));return l}}}();return function(a){return a}(function(a,m,q,l){return{q:a,a:m,n:q,Pa:l}}(function(a){function m(b){return b.filter(function(b,f,a){return a.lastIndexOf(b)===f})}function q(b,c){for(var f=b.length,a=-1,h=0;h<f;++h)if(c(b[h])){if(0<=a)throw Error("Multiple elements match the predicate.");a=h}return a}function l(b,c){return b&&"function"===typeof b.valueOf&&c&&"function"===typeof c.valueOf?b.valueOf()<=c.valueOf()?b.valueOf()<c.valueOf()?-1:0:1:b<=c?b<c?-1:0:1}function p(b,
c){var a=b.length,g=Array(a),h=Array(a),e;for(e=0;e<a;++e)g[e]=e,h[e]=b[e];e=b;b=h;h=e;g.sort(function(n,v){return c(b[n],b[v])||n-v});for(e=0;e<a;++e)h[e]=b[g[e]];return h}return{contains:function(b,c){return 0<=b.indexOf(c)},D:function(b){if(50<b.length){for(var c=b.length,f={},g,h=0;h<c;++h)if(g=b[h],"string"===typeof g)if(a.r(f,g))break;else f[g]=!0;else if(b.lastIndexOf(g)!==h)break;if(!(h>=c)){for(var e=b.slice(0,h);h<c;++h)g=b[h],"string"===typeof g?a.r(f,g)||(f[g]=!0,e.push(g)):b.lastIndexOf(g)===
h&&e.push(g);b=e}}else b=m(b);return b},U:function(b,c){return Array.prototype.concat.apply([],b.map(c))},R:function(b,c){var a=q(b,c);if(0>a)throw Error("None of the elements matches the predicate.");return b[a]},Xa:function(b,a){var f=q(b,a);return 0<=f?b[f]:null},Oa:function(b,a){var f=a||l;window.chrome?f=p(b,f):(b.sort(f),f=b);return f}}}(a),function(){function a(d){return function(){return d}}return{bb:a(!0),Za:a(!1),b:a(void 0),ab:a(null),Sa:a(0),Ta:a,ya:function(a){return a}}}(),a,{sa:function(a){return a.replace(/([A-Z])/g,
function(a){return"-"+a.toLowerCase()})},f:function(a){return a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(a){var m=arguments;return a.replace(/{(\d+)}/g,function(a,l){var p=parseInt(l,10)+1;return typeof m.length<=p?a:m[p]})}}))}();C=function(){var a=/^[a-z]+(-[a-z]+)*$/,d=/\x3c!--(?:(before|after):)?([a-z]+(-[a-z]+)*)--\x3e*/g;return function(m){function q(a,c){c=c||function(a,n){return n+a};return function(e){var n=l(e,a);return{Y:function(a,k){var e=k?a:null,
g=(k=k?k:a)?e:null,d=k,e=c;g&&b(g,2);p(d);g=g?l(g,3)+d+l(g,4):d;e=e(n,g);f=f.replace(n,e)}}}}function l(a,b){function e(n){if(c[a]!==n)throw Error("Operation is not defined for placeholder `"+a+"`.");}if(!c[a])throw Error("Unknown placeholder id `"+a+"`.");var n="\x3c!--"+a+"--\x3e",v="\x3c!--before:"+a+"--\x3e",k="\x3c!--after:"+a+"--\x3e";switch(b){case 1:return e(1),delete c[a],n;case 2:return e(1),n;case 3:return e(2),v;case 4:return e(2),k;case 5:case 6:return 1===c[a]?"\x3c!--"+a+"--\x3e":5===
b?k:v}throw Error("Assertion error. Unkown operator: `"+b+"`");}function p(a){for(var c;c=d.exec(a);){var e=c[1],n="before"===e;c=c[2];if(e&&1!==(a.match(new RegExp((n?"after":"before")+":"+c,"g"))||[]).length)throw Error("Multiple or unmatched before-/after-placeholders for placeholder id `"+c+"`.");e&&!n||b(c,e?2:1)}}function b(b,f){if(!a.test(b))throw Error("Invalid placeholder id `"+b+"`");if(c[b])throw Error("Placeholder id `"+b+"` is already taken.");c[b]=f}var c={},f=m;p(f);this.Aa=q(2);this.replace=
function(a){return{ha:q(1,function(a,b){return b})(a).Y}};this.ma=function(){return f.replace(d,"")}}}();D=function(a,d,m){function q(a){return null===a?"":""+a}function l(l,b,c){this.id=this.id=c.id;this.property=this.K=c.property||this.id;this.userDefined=this.L=!1!==c.L;this.h=!c.hidden;this.visible=this.visible;this.label=this.label=a.observable(c.label);this.width=this.width=a.observable(c.width);this.widthInPixels=this.M=function(){var a=this.width();if("px"!==a.substr(-2))throw Error("The only currently supported column width values are absolute pixel lengths.");
return parseInt(a.substring(0,a.length-2),10)}.bind(this);this.W=a.observableArray(c.headerClasses||c.classes||[]);this.P=a.observableArray(c.cellClasses||c.classes||[]);this.f=a.observableArray(c.footerClasses||c.classes||[]);this.headerClasses=this.W;this.cellClasses=this.P;this.footerClasses=this.f;this.metadata=this.F=b.columnMetadataProvider?b.columnMetadataProvider(l,c):{};this.renderValue=this.w=b.cellValueRenderer?b.cellValueRenderer.bind(void 0,this):q;this.R=function(a){this.w=a(this.w)}.bind(this);
this.D=function(a){a=a({k:this.m,update:this.O});if(!a||!a.k||!a.update)throw Error("The cell value binding must define an `init` as well as an `update` method.");this.m=a.k;this.O=a.update}.bind(this);this.overrideValueRendering=this.R;this.overrideValueBinding=this.D}a.bindingHandlers.__gridColumn={init:d.a.b,update:function(a,b){var c=b();a.style.width=c.width()}};return{k:function(a){a.replace("columns").ha(m)},g:function(d,b,c){function f(a){a=new l(c,b,a);b.columnInitializer&&b.columnInitializer(a);
return a}var g=[];this.all=this.all=a.observableArray(d.columns.map(f));this.byId=this.na=function(a){var b=this.fa(a);if(!b)throw Error("The column id `"+a+"` is undefined.");return b}.bind(this);this.tryById=this.fa=function(a){var b=this.all().filter(function(b){return b.id===a});if(1<b.length)throw Error("Assertion error: Multiple columns with id `"+a+"`.");return b[0]}.bind(this);var h=a.observable(this.all().filter(function(a){return a.h}));this.displayed=this.d=function(){return h()};this.show=
function(a){this.s(function(b){return b.h||b===a})}.bind(this);this.xa=function(a){this.s(function(b){return b.h&&b!==a})}.bind(this);this.show=this.show;this.hide=this.xa;this.reorder=this.Na=function(a){var b=this.all().slice(),c=[];a.forEach(function(a){b.splice(b.indexOf(a),1);c.push(a)});if(b.length)throw Error("The new column order must contain all columns.");this.all(c);this.s(function(a){return a.h})}.bind(this);this.showOnlyThoseWhich=this.s=function(a){var b=this.all();a=b.filter(a);b.forEach(function(a){a.h=
!1});a.forEach(function(a){a.h=!0});h(a)}.bind(this);this.combinedWidth=this.qa=a.pureComputed(function(){for(var a=0,b=this.d(),c=0;c<b.length;++c)a+=b[c].M();return a}.bind(this));this.add=this.add=function(a){a=f({L:!1,id:"$"+a.id,label:a.label,hidden:a.hidden||!1,width:a.width});this.all.unshift(a);this.s(function(a){return a.h});return a}.bind(this);this.i=function(){g.forEach(function(a){a.dispose()})}}}}(r,t,'<colgroup class="ko-grid-colgroup">\n    <col class="ko-grid-col" data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\' }" data-repeat-bind="__gridColumn: column()">\n</colgroup>');
x=function(a,d){function m(l){var d=l.defaultPrevented;a.n.extend(this,l,{preventDefault:function(){d=!0;return l.preventDefault()},f:function(){d=!0},get defaultPrevented(){return d}})}function q(a,d){this.J=a;this.ea=d}return function(l){function p(c,f,g){function l(a){a=Array.prototype.slice.call(c.querySelectorAll(a)).filter(function(a){return d.Ba(a,f.target)});return a.length?a[a.length-1]:void 0}var e=d.ua.bind(null,c),n=b.map(function(a){var b=a.ea?l(a.ea):c;return{J:a.J,match:b,depth:b?e(b):
-1}}).filter(function(a){return!!a.match});a.q.Oa(n,function(a,b){return b.depth-a.depth});n.forEach(function(a){a.J.apply(c,g)})}l=l||function(a){return[a]};var b=[];this.o=function(a,f){var d=1<arguments.length?a:void 0;f=1<arguments.length?f:a;b.push(new q(f,d))};this.da=function(a){return{S:function(b){var g=d.element.oa(b.target,a);g&&(b=new m(b),p(g,b,l(b,g)))}}}}}(t,function(){return function(a){return a}(function(){function a(a,d){return!!(a.compareDocumentPosition(d)&16)}var d=window.Element,
m=d.prototype.webkitMatchesSelector||d.prototype.mozMatchesSelector||d.prototype.msMatchesSelector||d.prototype.matches;return{ua:function(a,d){for(var m=0;d;){if(d===a)return m;d=d.parentNode;++m}throw Error("The given node is not part of the subtree.");},Ba:function(d,l){return d===l||a(d,l)},Ya:a,element:{oa:function(a,d){do{if(m.call(a,d))return a;a=a.parentElement}while(a);return null},matches:function(a,d){return m.call(a,d)}}}}())}());E=function(a,d,m,q){function l(a){this.e(function(b){b();
this.l=a.element.querySelector(".ko-grid-tbody")}.bind(this));return function(){this.l=null}.bind(this)}function p(){var b=[],c={};this.rows=this.rows=c;c.d=a.observableArray([]);c.displayed=c.d;c.I=a.observable(!1).extend({$a:"always"});c.displayedSynchronized=c.I;c.__handleDisplayedRowsDeviate=function(){this.rows.I(!1)}.bind(this);c.__handleDisplayedRowsSynchronized=function(){this.rows.I(!0)}.bind(this);this.ia(function(a){a();a=this.source.openView(function(a){return a.filteredBy(this.aa).sortedBy(this.Q).offsetBy(this.offset).limitedTo(this.Z)}.bind(this));
b.push(a);b.push(a.observables.subscribe(function(a){this.rows.d(a)}.bind(this)));c.d(a.observables())}.bind(this));var k=[];c.__classify=function(a){var b=k.map(function(b){return b(a)});return Array.prototype.concat.apply([],b)};c.za=function(a){k.push(a)};c.installClassifier=c.za;return function(){b.forEach(function(a){a.dispose()})}}function b(){function b(c,n){var k=a.contextFor(n),d=k.row(),k=k.column();return[c,d[k.K],d,k]}function c(a){return function(b){a.da(".ko-grid-cell").S(b);return!b.defaultPrevented}}
var k=new m(b),B=new m(b),e=new m(b),f=new m(b);this.Ia=k.o.bind(k);this.Fa=B.o.bind(B);this.Ha=e.o.bind(e);this.Ga=f.o.bind(f);this["onCellMouseDown "]=this.Ia;this["onCellClick "]=this.Fa;this["onCellDoubleClick "]=this.Ha;this["onCellContextMenu "]=this.Ga;this.e(function(a){a();this.l.addEventListener("mousedown",c(k));this.l.addEventListener("click",c(B));this.l.addEventListener("dblclick",c(e));this.l.addEventListener("contextmenu",c(f))}.bind(this));return d.a.b}function c(b){function c(a,
b){for(var k=a.firstChild,n=-1;k;){if(k.nodeType===g&&"TD"===k.tagName&&0<=(" "+k.className+" ").indexOf("td")&&++n===b)return k;k=k.nextSibling}throw Error("Column `"+b+"` does not exist.");}var k=function(a){for(var b=this.l.firstChild,c=-1;b;){if(b.nodeType===g&&"TR"===b.tagName&&0<=(" "+b.className+" ").indexOf("ko-grid-row")&&++c===a)return b;b=b.nextSibling}throw Error("Row `"+a+"` does not exist.");}.bind(this);this.lookupCell=this.Da=function(d,g){var l=this.rows.d().indexOf(d),m=b.c.d().indexOf(g),
h=c(k(l),m);return{element:h,hijack:function(b){function c(){for(h.removeAttribute("data-hijacked");h.firstChild;)a.removeNode(h.firstChild);var b=a.contextFor(h).row();g.m?g.m(h,b,g):h.appendChild(e.createTextNode(""));f(h,b(),g)}if(h.hasAttribute("data-hijacked"))throw Error("Illegal state: This cell is already hijacked.");for(;h.firstChild;)a.removeNode(h.firstChild);h.className+=" "+b;h.setAttribute("data-hijacked","hijacked "+b);return{dispose:c,release:c}}}}.bind(this);return d.a.b}function f(b,
c,k){var d=c[k.K],e=d&&a.unwrap(d),f=b.getAttribute("data-hijacked"),g=k.P.peek().join(" ");b.className="ko-grid-td ko-grid-cell "+g+(f?" "+f:"");f||(k.m?k.O(b,d,c,k):b.lastChild.nodeValue=k.w(e))}var g=window.Node.ELEMENT_NODE,h=d.a.Sa,e=window.document;a.bindingHandlers.__gridRow={init:d.a.b,update:function(a,b){var c=b(),d=c.classify,e=c.row(),c=1===c.index()%2?["ko-grid-tr","ko-grid-row","alternate"]:["ko-grid-tr","ko-grid-row"],d=d(e);a.className=c.concat(d).join(" ")}};a.bindingHandlers.__gridCell=
{init:function(b,c){for(var k=c(),d=k.row,k=k.column,f=k();b.firstChild;)a.removeNode(b.firstChild);f.m?f.m(b,d,k):b.appendChild(e.createTextNode(""));return{controlsDescendantBindings:!0}},update:function(a,b){var c=b(),d=c.row(),c=c.column.peek();f(a,d,c)}};return{k:function(a){a.Aa("body").Y(q)},g:function(n,f,k){var e=[];this.source=n.dataSource;this.valueSelector=this.ga=n.valueSelector||f.valueSelector||d.a.ya;this.observableValueSelector=this.Ea=n.observableValueSelector||f.observableValueSelector||
this.ga;this.predicates=this.ba=a.observableArray(n.filters||[]);this.predicate=this.aa=a.pureComputed(function(){var b=this.ba().map(a.unwrap);return function(a){for(var c=0;c<b.length;c++)if(!b[c](a))return!1;return!0}}.bind(this));this.comparator=this.Q=a.observable(h);this.offset=this.offset=a.observable(0);this.limit=this.Z=a.observable(Number.POSITIVE_INFINITY);this.t=d.a.b;this.ia=function(a){var b=this.t;this.t=function(){a(b)}}.bind(this);this.p=d.a.b;this.e=function(a){var b=this.p;this.p=
function(){a(b)}}.bind(this);e.push(l.call(this,k));e.push(p.call(this));e.push(b.call(this));e.push(c.call(this,k));this.i=function(){e.forEach(function(a){a()})}}}}(r,t,x,'<tbody class="ko-grid-tbody" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    <tr class="ko-grid-tr ko-grid-row"\n        data-bind="indexedRepeat: {\n            forEach: data.rows.displayed,\n            indexedBy: function(r) { return grid.data.observableValueSelector(ko.unwrap(r[grid.primaryKey])); },\n            as: \'row\',\n            at: \'rowIndex\',\n            allowDeviation: true,\n            onDeviation: data.rows.__handleDisplayedRowsDeviate,\n            onSynchronization: data.rows.__handleDisplayedRowsSynchronized }"\n        data-repeat-bind="__gridRow: { classify: grid.data.rows.__classify, row: row, index: rowIndex }">\n\n        <td data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\', allowElementRecycling: false }"\n            data-repeat-bind="__gridCell: { row: row, column: column }"></td>\n    </tr>\n</tbody>');
x=function(a,d,m,q){function l(b){this.id=this.id="column-header-"+b.id;this.element=this.element=a.observable(null);this.rowSpan=this.rowSpan=a.observable(1);this.columnSpan=this.j=a.observable(1);this.label=this.label=b.label;this.column=this.G=b;this.columns=this.c=[b];this.B=function(a){this.rowSpan(a)}.bind(this)}function p(b){this.id=this.id="column-group-header-"+(b.id||"@__"+ ++e);this.element=this.element=a.observable(null);this.ja=b;this.rowSpan=this.rowSpan=a.observable(b.height);this.columnSpan=
this.j=a.observable(1);this.label=this.label=a.observable(b.label);this.columns=this.c=[];this.B=function(a){this.c=[a];this.j(1)}.bind(this)}function b(a){function b(a){a.pa.forEach(function(b){var c=k[b];if(!c)k[b]=a;else if(c!==a)throw Error("Column `"+b+"` is element of column group `"+c.label+"` as well as `"+a.label+"`.");});a.u&&b(a.u)}var k={};d.q.U(a,c.bind(this,null)).forEach(function(a){b(a)});return k}function c(a,b){var k=f(b),e=b.elements.filter(function(a){return"string"!==typeof a}),
g=b.elements.filter(function(a){return"string"===typeof a}),k={id:b.id,label:b.label,u:a,depth:a?a.depth+1:0,height:a?a.$-k:1,$:k,pa:g};return e.length?d.q.U(e,c.bind(this,k)):k}function f(a){a=a.elements.filter(function(a){return"string"!==typeof a});return 1+Math.max.apply(Math,[0].concat(a.map(f)))}var g=window.document,h=window.Node,e=0;a.bindingHandlers.__gridHeader={init:function(b,c){var d=c()();d.element(b);a.utils.domNodeDisposal.addDisposeCallback(b,function(){d.element(null)});for(var e=
b.firstChild;e;){var f=e;f.nodeType===h.TEXT_NODE&&a.removeNode(f);e=e.nextSibling}b.insertBefore(g.createTextNode(""),b.firstChild);return{controlsDescendantBindings:!0}},update:function(a,b){var c=b()(),d=c.id.replace(/[\s]/g,"_");a.className=c.G?"ko-grid-th ko-grid-column-header "+d+" "+c.G.W().join(" "):"ko-grid-th ko-grid-column-group-header "+d;d=c.c.map(function(a){return a.M()}).reduce(function(a,b){return a+b})+"px";a.style.width=d;a.style.maxWidth=d;a.rowSpan=c.rowSpan();a.colSpan=c.j();
for(d=a.firstChild;d.nodeType!==h.TEXT_NODE;)d=d.nextSibling;d.nodeValue=c.label()}};return{k:function(a){a.replace("head").ha(q)},g:function(c,d,e){function f(a,b,c){if(!a)return[];if(b[a.depth]&&b[a.depth].ja===a){var d=a;do{var e=b[d.depth];e.c.push(c);e.j(e.j()+1);d=d.u}while(d);return[]}b.length=a.depth;var d=f(a.u,b,c),k=e=a.depth;a=g(q,new p(a));a.B(c);d[e]=b[k]=a;return d}function g(a,b){var c=b.id;return a[c]=a[c]||b}var h=b(c.columnGroups||[]),q={},r={},u=[];this.__rows=this.C=a.computed(function(){var b=
e.c.d(),c=0;b.forEach(function(a){a=h[a.id];c=Math.max(c,a?a.depth+a.$:0)});u.length=c+1;for(var d=0;d<u.length;++d)u[d]=u[d]||a.observableArray(),u[d].__rowId="header-row-"+d,u[d].valueWillMutate(),u[d]().length=0;var m=[];b.forEach(function(a){var b=h[a.id],d=b?b.depth+b.height:0;m.length=d;var e=g(r,new l(a));e.B(c-d+1);u[d]().push(e);a=f(b,m,a);for(b=0;b<a.length;++b)a[b]&&u[b]().push(a[b])});u.forEach(function(a){a.valueHasMutated()});return u});this.all=this.all=a.computed(function(){var a=
[];this.C().forEach(function(b){Array.prototype.push.apply(a,b())});return a}.bind(this));this.forColumn=this.wa=function(a){a="column-header-"+a.id;if(!Object.prototype.hasOwnProperty.call(r,a))throw Error("Es existiert kein Header f\u00fcr die gegebene Spalte.");return r[a]};var y=new m(function(b,c){return[b,a.contextFor(c).header()]});this.__handleClick=function(a,b){y.da(".ko-grid-column-header, .ko-grid-column-group-header").S(b);return!b.defaultPrevented};this.Ka=y.o.bind(y);this.Ja=function(a,
b){function c(a,d){d instanceof l&&b.apply(this,arguments)}var d=1<arguments.length;b=d?b:a;y.o.apply(y,d?[a,c]:[c])};this.onHeaderClick=this.Ka;this.onColumnHeaderClick=this.Ja;this.i=function(){this.C.dispose();this.all.dispose()}.bind(this)}}}(r,t,x,'<thead class="ko-grid-thead" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    \x3c!--before:headers--\x3e\n    <tr class="ko-grid-tr ko-grid-headers"\n        data-bind="indexedRepeat: { forEach: headers.__rows, indexedBy: \'__rowId\', as: \'headerRow\' }"\n        data-repeat-bind="click: headers.__handleClick">\n\n        <th class="ko-grid-th"\n            data-bind="indexedRepeat: { forEach: headerRow(), indexedBy: \'id\', as: \'header\' }"\n            data-repeat-bind="__gridHeader: header"></th>\n    </tr>\n    \x3c!--after:headers--\x3e\n</thead>');
A=function(a,d,m,q,l){a=a.bindingHandlers.grid=a.bindingHandlers.grid||{};return a.core=a.core||{columns:d,data:m,headers:q,layout:l}}(r,D,E,x,function(a,d){function m(a,c,d,g){var h=a.element,e=h.querySelector(".ko-grid-table-scroller-padding"),m=h.querySelector(".ko-grid-table-scroller"),p=h.querySelector(".ko-grid-thead"),k=h.querySelector(".ko-grid-tfoot"),q=!1;return function(a){if(!q)try{c(q=!0);var b=m.scrollLeft;a&&a();d.forEach(function(a){a.call(h)});l(h,function(){e.style.borderTopWidth=
Math.max(p.clientHeight,0)+"px";e.style.borderBottomWidth=Math.max(k.clientHeight,0)+"px"});m.scrollLeft=b;g.forEach(function(a){a.call(h)})}finally{c(!1),q=!1}}}function q(a){a=a.element;var c=a.querySelector(".ko-grid-table-scroller"),d=a.querySelector(".ko-grid-thead"),g=a.querySelector(".ko-grid-tfoot");c.addEventListener("scroll",function(){var a=-c.scrollLeft+"px";d.style.left=a;g.style.left=a})}function l(a,c){if(a.offsetWidth&&a.offsetHeight)c();else{var d=a.parentNode,g=p.createComment("placeholder");
d.replaceChild(g,a);var h=a.style.position;a.style.position="absolute";a.style.visibility="hidden";p.body.appendChild(a);try{c()}finally{d.replaceChild(a,g),a.style.position=h,a.style.visibility="visible"}}}var p=window.document;return{k:d.a.b,g:function(b,c,d){function g(a){a&&a()}var h=a.observable(!1);this.recalculate=this.Ma=function(a){g(a)};var e=a.computed(function(){h()||(d.c.d().forEach(function(a){a.width()}),g())}),l=[],v=[];this.la=function(a){l.push(a)};this.ka=function(a){v.push(a)};
this.beforeRelayout=this.la;this.afterRelayout=this.ka;this.p=function(){q.call(this,d);g=m(d,h,l,v);d.La(g)}.bind(this);this.determineCellDimensions=this.ta=function(a){var b=p.createElement("div");b.className="ko-grid-td ko-grid-cell";b.appendChild("string"===typeof a?p.createTextNode(a):a);b.style.position="absolute";b.style.visibility="hidden";p.body.appendChild(b);try{return{width:b.offsetWidth,height:b.offsetHeight}}finally{p.body.removeChild(b)}};this.i=function(){e.dispose()}}}}(r,t));(function(a,
d){function m(a,c){if(d.n.r(p,a))throw Error("Extension id or alias already in use: `"+a+"`.");p[a]=c;c.A.push(a);return c}function q(a,c){this.ca=a;this.H=c.H||[];this.X=c.X||d.a.b;this.g=c.g;this.A=[]}var l=a.bindingHandlers.grid=a.bindingHandlers.grid||{},p=l.extensions=l.extensions||{};l.Wa=function(a,c){return m(a,new q(a,c))};l.v=function(a){if(!d.n.r(p,a))throw Error("No known extension id or alias: `"+a+"`.");return p[a]};l.Ua=function(a,c){return m(a,l.v(c))};l.Va=function(a,c){var d=l.v(c);
a.forEach(function(a){return m(a,d)});return d};q.prototype={get Ca(){return this.A.slice()},T:function(a,c){var d=this.N(a,function(a){throw Error("Conflicting configurations "+a.map(function(a){return"`"+a+"`"}).join(", ")+" (configuration: `"+c+"`).");});if(!d)throw Error("The extension `"+this.ca+"` must be configured (configuration: `"+c+"`)");return a[d]},Ra:function(a){var c=this.N(a,function(a){throw Error("Conflicting binding values "+a.map(function(a){return"`"+a+"`"}).join(", ")+".");});
return a[c]},N:function(a,c){var f=this.A.filter(function(c){return d.n.r(a,c)});1<f.length&&c(f);return f[0]}};return p})(r,t);return function(a){return a}(function(a,d,m){function q(c,d){function l(){var a=h[c];d(a.ra,a.Qa,a.va)}h[c]?l():a([c],function(a){function d(g){g=b.v(g);var f=g.ca,h=g.T(n,c);if(!m.q.contains(q,f)){if(m.q.contains(r,f))throw Error("Dependency-Cycle: .. -> "+r.join(" -> ")+" -> "+f+" -> ..");r.push(f);g.H.forEach(d);g.X(p,h,a);if(r.pop()!==f)throw Error("Assertion error.");
q.push(f)}}var p=new C('<div class="ko-grid">\n    \x3c!--before:grid--\x3e\n    <div class="ko-grid-table-container">\n        \x3c!--before:table--\x3e\n        <div class="ko-grid-table-scroller-padding">\n            <div class="ko-grid-table-scroller">\n                <table class="ko-grid-table" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n                    \x3c!--columns--\x3e\n                    \x3c!--head--\x3e\n                    <tfoot class="ko-grid-tfoot" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\x3c!--tfoot--\x3e</tfoot>\n                    \x3c!--body--\x3e\n                </table>\n            </div>\n        </div>\n        \x3c!--after:table--\x3e\n    </div>\n    \x3c!--after:grid--\x3e\n</div>');
f.forEach(function(b){b.k(p,a)});var n=a.extensions,q=[],r=[];Object.keys(n).forEach(d);var u="ko-grid-template-"+c;g.f(u,p.ma());h[c]={ra:a,Qa:u,va:q};l()})}function l(a,b){this.primaryKey=this.f=b.primaryKey;this.rootElement=a;this.element=this.element=null;d.observableArray([]);this.e=this.i=m.a.b;this.La=function(a){if(!this.e)throw Error("Illegal state: postApplyBindings-callbacks have been called already.");var b=this.e;this.e=function(){b();a()}}.bind(this)}var p=window.document,b=d.bindingHandlers.grid=
d.bindingHandlers.grid||{},c=["columns","headers","data","layout"],f=c.map(function(a){return A[a]}),g=new d.nativeTemplateEngine;g.f=function(a,b){var c=p.createElement("script");c.id=a;c.type="text/html";c.text=b;p.querySelector("head").appendChild(c)};d.bindingHandlers.grid.init=function(a,f,h,k,p){var r=f(),t=r.config;q(t,function(f,h,k){var q=[],n=new l(a,r);d.utils.domNodeDisposal.addDisposeCallback(a,function(){n.i();q.forEach(function(a){a()})});m.n.V(A,function(a,b){var c=new b.g(r,f,n);
n[a]=c;n.c=n.columns;n.headers=n.headers;n.data=n.data;n.F=n.layout;"function"===typeof c.i&&q.push(c.i.bind(c))});var v=f.extensions,w=r.extensions||{},x=n.extensions=n.D={};for(k.forEach(function(a){a=b.v(a);var c=a.T(v,t),d=a.Ra(w)||{};if((!1!==c.enabled||!0===d.enabled)&&!1!==d.enabled){a.H.forEach(function(a){if(!x[a])throw Error("Dependency '"+a+"' was disabled.");});var e=new a.g(d,c,n,r,f);a.Ca.forEach(function(a){x[a]=e});"function"===typeof e.dispose&&q.push(e.dispose.bind(e))}});a.firstChild;)d.removeNode(a.firstChild);
c.forEach(function(a){n[a].t&&n[a].t()});k=p.createChildContext(n,"grid");d.renderTemplate(h,k,{templateEngine:g},a);var z=a.querySelector(".ko-grid");n.element=z;n.element=z;m.n.V(v,function(a){z.className+=" with-"+m.Pa.sa(a)});c.forEach(function(a){n[a].p&&n[a].p()});n.e();n.e=null});return{controlsDescendantBindings:!0}};d.bindingHandlers.grid.update=m.a.b;var h={};d.bindingHandlers._gridWidth={init:m.a.b,update:function(a,b){var c=b();a.style.width=c;a.style.maxWidth=c}};return b}(w,r,t))});
