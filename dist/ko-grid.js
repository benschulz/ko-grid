/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
(function(x){"function"===typeof define&&define.amd?define(["require","knockout","ko-data-source","ko-indexed-repeat"],x):window["ko-grid"]=x(function(q,r){if(!Array.isArray(q)||1!==q.length||"string"!==typeof q[0]||"function"!==typeof r)throw Error("Assertion error.");var x=window.ko.bindingHandlers.grid.config=window.ko.bindingHandlers.grid.config||{};r(x[q[0]])},window.ko)})(function(x,q){var r,C,D,w,y,B;r=function(){var a;a=function(){function a(m,k){return Object.prototype.hasOwnProperty.call(m,
k)}return{Ua:function(a,k){if(a===k)return!0;var f=!!k&&"function"===typeof k.valueOf;return!!a&&"function"===typeof a.valueOf&&f&&a.valueOf()===k.valueOf()},extend:function(a,k){Array.prototype.slice.call(arguments,1).forEach(function(f){for(var d=Object.keys(f),b=0,c=d.length;b<c;b++){var e=d[b],h=Object.getOwnPropertyDescriptor(f,e);void 0!==h&&h.enumerable&&Object.defineProperty(a,e,h)}});return a},aa:function(m,k){for(var f in m)a(m,f)&&k(f,m[f])},q:a,rb:function(m,k){var f={},d;for(d in m)a(m,
d)&&(f[d]=k(m[d],d,m));return f}}}();return function(a){return a}(function(a,m,k){return{g:a,c:m,L:k}}(function(a){function m(b){return b.filter(function(b,e,h){return h.lastIndexOf(b)===e})}function k(b,c){for(var e=b.length,h=-1,a=0;a<e;++a)if(c(b[a])){if(0<=h)throw Error("Multiple elements match the predicate.");h=a}return h}function f(b,c){return b&&"function"===typeof b.valueOf&&c&&"function"===typeof c.valueOf?b.valueOf()<=c.valueOf()?b.valueOf()<c.valueOf()?-1:0:1:b<=c?b<c?-1:0:1}function d(b,
c){var e=b.length,h=Array(e),a=Array(e),g;for(g=0;g<e;++g)h[g]=g,a[g]=b[g];g=b;b=a;a=g;h.sort(function(g,l){return c(b[g],b[l])||g-l});for(g=0;g<e;++g)a[g]=b[h[g]];return a}return{contains:function(b,c){return 0<=b.indexOf(c)},gb:function(b){if(50<b.length){for(var c=b.length,e={},h,d=0;d<c;++d)if(h=b[d],"string"===typeof h)if(a.q(e,h))break;else e[h]=!0;else if(b.lastIndexOf(h)!==d)break;if(!(d>=c)){for(var g=b.slice(0,d);d<c;++d)h=b[d],"string"===typeof h?a.q(e,h)||(e[h]=!0,g.push(h)):b.lastIndexOf(h)===
d&&g.push(h);b=g}}else b=m(b);return b},$:function(b,c){return Array.prototype.concat.apply([],b.map(c))},yb:function(b,c){var e=k(b,c);if(0>e)throw Error("None of the elements matches the predicate.");return b[e]},zb:function(b,c){var e=k(b,c);return 0<=e?b[e]:null},Na:function(b,c){var e=c||f;window.chrome?e=d(b,e):(b.sort(e),e=b);return e}}}(a),a,{ra:function(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},ab:function(a){return a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},
format:function(a){var m=arguments;return a.replace(/{(\d+)}/g,function(a,f){var d=parseInt(f,10)+1;return typeof m.length<=d?a:m[d]})}}))}();C=function(){var a=/^[a-z]+(-[a-z]+)*$/,p=/\x3c!--(?:(before|after):)?([a-z]+(-[a-z]+)*)--\x3e*/g;return function(m){function k(a,c){c=c||function(g,b){return b+g};return function(g){var t=f(g,a);return{O:function(l,n){var g=n?l:null,a=(n=n?n:l)?g:null,h=n,g=c;a&&b(a,2);d(h);a=a?f(a,3)+h+f(a,4):h;g=g(t,a);e=e.replace(t,g)}}}}function f(a,b){function g(l){if(c[a]!==
l)throw Error("Operation is not defined for placeholder `"+a+"`.");}if(!c[a])throw Error("Unknown placeholder id `"+a+"`.");var e="\x3c!--"+a+"--\x3e",l="\x3c!--before:"+a+"--\x3e",n="\x3c!--after:"+a+"--\x3e";switch(b){case 1:return g(1),delete c[a],e;case 2:return g(1),e;case 3:return g(2),l;case 4:return g(2),n;case 5:case 6:return 1===c[a]?e:5===b?n:l}throw Error("Assertion error. Unkown operator: `"+b+"`");}function d(a){for(var c;c=p.exec(a);){var g=c[1],e="before"===g;c=c[2];if(g&&1!==(a.match(new RegExp((e?
"after":"before")+":"+c,"g"))||[]).length)throw Error("Multiple or unmatched before-/after-placeholders for placeholder id `"+c+"`.");g&&!e||b(c,g?2:1)}}function b(b,e){if(!a.test(b))throw Error("Invalid placeholder id `"+b+"`");if(c[b])throw Error("Placeholder id `"+b+"` is already taken.");c[b]=e}var c={},e=m;d(e);this.replace=function(a){return{fa:k(1,function(a,g){return g})(a).O}};this.Oa=function(a){return{append:k(5)(a).O,Ia:k(6,function(a,g){return a+g})(a).O}};this.Wa=function(){return e.replace(p,
"")}}}();D=function(a,p,m){function k(a){return null===a?"":""+a}function f(d,b,c){this.id=this.id=c.id;this.property=this.da=c.property||this.id;this.userDefined=this.ea=!1!==c.ea;this.n=!c.hidden;this.visible=this.visible;this.label=this.label=a.observable(c.label);this.width=this.width=a.observable(c.width);this.widthInPixels=this.R=function(){var a=this.width();if("px"!==a.substr(-2))throw Error("The only currently supported column width values are absolute pixel lengths.");return parseInt(a.substring(0,
a.length-2),10)}.bind(this);this.wa=a.observableArray(c.headerClasses||c.classes||[]);this.oa=a.observableArray(c.cellClasses||c.classes||[]);this.b=a.observableArray(c.footerClasses||c.classes||[]);this.headerClasses=this.wa;this.cellClasses=this.oa;this.footerClasses=this.b;this.metadata=this.na=b.columnMetadataSupplier?b.columnMetadataSupplier(d.Va,c):{};this.renderValue=this.J=b.cellValueRenderer?b.cellValueRenderer.bind(void 0,this):k;this.sa=function(a){this.J=a(this.J)}.bind(this);this.F=function(a){a=
this.ja(a);if(!a||!a.e||!a.update)throw Error("The cell value binding must define an `init` as well as an `update` method.");this.B=a.e;this.X=a.update}.bind(this);this.ja=function(a){a=a(p.c.extend({e:this.B,update:this.X},{init:this.B,update:this.X}));return{e:a.e||a.init,update:a.update||a.update}}.bind(this);this.overrideValueRendering=this.sa;this.overrideValueBinding=this.F}a.bindingHandlers.__gridColumn={init:function(){},update:function(a,b){var c=b();a.style.width=c.width()}};return{e:function(a){a.replace("columns").fa(m)},
m:function(d,b,c){function e(a){a=new f(c,b,a);b.columnInitializer&&b.columnInitializer(a);return a}var h=[];this.all=this.all=a.observableArray(d.columns.map(e));this.byId=this.ma=function(a){var b=this.Pa(a);if(!b)throw Error("The column id `"+a+"` is undefined.");return b}.bind(this);this.tryById=this.Pa=function(a){var b=this.all().filter(function(l){return l.id===a});if(1<b.length)throw Error("Assertion error: Multiple columns with id `"+a+"`.");return b[0]}.bind(this);var k=a.observable(this.all().filter(function(a){return a.n}));
this.displayed=this.i=function(){return k()};this.show=function(a){this.K(function(b){return b.n||b===a})}.bind(this);this.kb=function(a){this.K(function(b){return b.n&&b!==a})}.bind(this);this.show=this.show;this.hide=this.kb;this.reorder=this.xb=function(a){var b=this.all().slice(),l=[];a.forEach(function(a){b.splice(b.indexOf(a),1);l.push(a)});if(b.length)throw Error("The new column order must contain all columns.");this.all(l);this.K(function(a){return a.n})}.bind(this);this.showOnlyThoseWhich=
this.K=function(a){var b=this.all();a=b.filter(a);b.forEach(function(a){a.n=!1});a.forEach(function(a){a.n=!0});k(a)}.bind(this);this.combinedWidth=this.Za=a.pureComputed(function(){for(var a=0,b=this.i(),l=0;l<b.length;++l)a+=b[l].R();return a}.bind(this));this.add=this.add=function(a){a=e({ea:!1,id:"$"+a.id,label:a.label,hidden:a.hidden||!1,width:a.width});this.all.unshift(a);this.K(function(a){return a.n});return a}.bind(this);this.o=function(){h.forEach(function(a){a.dispose()})}}}}(q,r,'<colgroup class="ko-grid-colgroup">\n    <col class="ko-grid-col" data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\' }" data-repeat-bind="__gridColumn: column()">\n</colgroup>');
w=function(a){var p,m,k;p=function(a){return function(d,b){return a.c.extend(d,{get stringifyable(){return b()}})}}(a);m=function(a,d){function b(){return 0}function c(a,b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function e(b,c){a.c.extend(b,{get onResultOf(){return this.I},get reverse(){return this.reverse},get callable(){return this.G}},{get I(){return function(a){return h(a,b)}},get reverse(){return function(){return c||k(b)}},get G(){return b}})}function h(a,
b){function l(l,c){return b(a(l),a(c))}e(l);d(l,function(){return{type:"by-function-comparator","function":a.stringifyable,comparator:b.stringifyable}});return l}function k(a){function b(l,c){return-a(l,c)}e(b,a);d(b,function(){return{type:"reversed-comparator",comparator:a.stringifyable}});return b}e(c);d(c,function(){return{type:"natural-comparator"}});e(b);d(b,function(){return{type:"indifferent-comparator"}});return{nb:b,b:c}}(a,p);k=function(a,d){function b(b){a.c.extend(b,{get callable(){return this.G}},
{get G(){return b}})}return{vb:function(a){function e(b){return b[a]}b(e);d(e,function(){return{type:"property-accessor",propertyName:a}});return e}}}(a,p);a=function(a,d){function b(){return!0}function c(){return!1}function e(b,c){a.c.extend(b,{get and(){return this.D},get negate(){return this.Ba},get onResultOf(){return this.I},get or(){return this.Q},get callable(){return this.G}},{get D(){return function(a){return h([b,a])}},get Ba(){return function(){return c||g(b)}},get I(){return function(a){return k(a,
b)}},get Q(){return function(a){return t([b,a])}},get G(){return b}})}function h(a){function c(b){for(var n=0,e=a.length;n<e;++n)if(!a[n](b))return!1;return!0}if(!a.length)return b;e(c);d(c,function(){return{type:"and-predicate",components:a.map(function(a){return a.stringifyable})}});return c}function k(a,b){function c(e){return b(a(e))}e(c);d(c,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:b.stringifyable}});return c}function g(a){function b(c){return!a(c)}
e(b,a);d(b,function(){return{type:"negated-predicate",predicate:a.stringifyable}});return b}function t(a){function b(c){for(var n=0,e=a.length;n<e;++n)if(a[n](c))return!0;return!1}if(!a.length)return c;e(b);d(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}e(c);d(c,function(){return{type:"always-false-predicate"}});e(b);d(b,function(){return{type:"always-true-predicate"}});return{b:c,F:b,D:h,na:function(a,b){function c(b){return a(b)}e(c);
d(c,b);return c},Q:t,wb:function(a){function b(c){return a.test(c)}e(b);d(b,function(){return{type:"regular-expression-predicate",regularExpression:a.source,caseSensitive:!a.ignoreCase,multiline:a.multiline}});return b}}}(a,p);return function(a){return a}({u:m,N:k,f:a,qb:p,Bb:function(a,d){return"function"===typeof d||"object"===typeof d?d.stringifyable||d:d}})}(r);y=function(a,p){function m(f){var d=f.defaultPrevented;a.c.extend(this,f,{preventDefault:function(){d=!0;return f.preventDefault()},sa:function(){d=
!0},get defaultPrevented(){return d}})}function k(a,d){this.ba=a;this.Ma=d}return function(f){function d(c,e,d){function f(a){a=Array.prototype.slice.call(c.querySelectorAll(a)).filter(function(a){return p.ya(a,e.target)});return a.length?a[a.length-1]:void 0}var g=p.ta.bind(null,c),k=b.map(function(a){var b=a.Ma?f(a.Ma):c;return{ba:a.ba,match:b,depth:b?g(b):-1}}).filter(function(a){return!!a.match});a.g.Na(k,function(a,b){return b.depth-a.depth});k.forEach(function(a){a.ba.apply(c,d)})}f=f||function(a){return[a]};
var b=[];this.w=function(a,e){var d=1<arguments.length?a:void 0;e=1<arguments.length?e:a;b.push(new k(e,d))};this.La=function(a){return{ua:function(b){var h=p.element.pa(b.target,a);h&&(b=new m(b),d(h,b,f(b,h)))}}}}}(r,function(){return function(a){return a}(function(){function a(a,f){return!!(a.compareDocumentPosition(f)&16)}var p=window.Element,m=p.prototype.webkitMatchesSelector||p.prototype.mozMatchesSelector||p.prototype.msMatchesSelector||p.prototype.matches;return{ta:function(a,f){for(var d=
0;f;){if(f===a)return d;f=f.parentNode;++d}throw Error("The given node is not part of the subtree.");},ya:function(k,f){return k===f||a(k,f)},Ab:a,element:{pa:function(a,f){do{if(m.call(a,f))return a;a=a.parentElement}while(a);return null},matches:function(a,f){return m.call(a,f)}}}}())}());w=function(a,p,m,k,f){function d(a){this.l(function(b){b();this.t=a.element.querySelector(".ko-grid-tbody")}.bind(this));return function(){this.t=null}.bind(this)}function b(){var b=[],c={};this.rows=this.rows=
c;c.i=a.observableArray([]);c.displayed=c.i;c.Z=a.observable(!1).extend({Kb:"always"});c.displayedSynchronized=c.Z;c.__handleDisplayedRowsDeviate=function(){this.rows.Z(!1)}.bind(this);c.__handleDisplayedRowsSynchronized=function(){this.rows.Z(!0)}.bind(this);var e=this.view;c.__dirty=e.dirty;b.push(e.observables.subscribe(function(a){c.i(a)}));c.i(e.observables());var d=[];c.__classify=function(a){var b=d.map(function(b){return b(a)});return Array.prototype.concat.apply([],b)};c.ob=function(a){d.push(a)};
c.installClassifier=c.ob;return function(){b.forEach(function(a){a.dispose()})}}function c(){function b(c,e){var l=a.contextFor(e),d=l.row(),l=l.column();return[c,d[l.da],d,l]}function c(a){return function(b){a.La(".ko-grid-cell").ua(b);return!b.defaultPrevented}}var e=new k(b),d=new k(b),g=new k(b),h=new k(b);this.ub=e.w.bind(e);this.Ca=d.w.bind(d);this.tb=g.w.bind(g);this.sb=h.w.bind(h);this["onCellMouseDown "]=this.ub;this["onCellClick "]=this.Ca;this["onCellDoubleClick "]=this.tb;this["onCellContextMenu "]=
this.sb;this.l(function(a){a();this.t.addEventListener("mousedown",c(e));this.t.addEventListener("click",c(d));this.t.addEventListener("dblclick",c(g));this.t.addEventListener("contextmenu",c(h))}.bind(this));return function(){}}function e(b){function c(a,b){for(var d=a.firstChild,e=-1;d;){if(d.nodeType===g&&"TD"===d.tagName&&0<=(" "+d.className+" ").indexOf("td")&&++e===b)return d;d=d.nextSibling}throw Error("Column `"+b+"` does not exist.");}var e=function(a){for(var b=this.t.firstChild,c=-1;b;){if(b.nodeType===
g&&"TR"===b.tagName&&0<=(" "+b.className+" ").indexOf("ko-grid-row")&&++c===a)return b;b=b.nextSibling}throw Error("Row `"+a+"` does not exist.");}.bind(this),d=[];this.rows.__handleElementRecycling=function(a){Array.prototype.slice.call(a.querySelectorAll(".ko-grid-cell")).forEach(function(a){return a["__@__hijacked"]=null})};this.rows.__handleElementRecycled=function(c,e){var g=e.row(),n=this.ca(a.unwrap(g[b.primaryKey]));p.c.q(d,n)&&d[n].forEach(function(a){var d=a.H,e=b.h.i().indexOf(d),e=c.children[e];
a.element=e;e["__@__hijacked"]=a;a.e&&h(e,g,d);v(e,g,d)})}.bind(this);this.lookupCell=this.Aa=function(g,f){function t(a,b){function c(){1===n.length?delete d[k]:n.splice(n.indexOf(l),1);l.element["__@__hijacked"]===l&&(l.element["__@__hijacked"]=null,h(l.element,g,f),v(l.element,g,f))}if(z["__@__hijacked"])throw Error("Illegal state: This cell is already hijacked.");var e=f.ja(b||function(a){return a}),l=z["__@__hijacked"]={element:z,H:f,Xa:a,e:e.e,update:e.update},n=d[k]=d[k]||[];n.push(l);l.e&&
h(z,g,f);v(z,g,f);return p.c.extend({b:c,dispose:c},{dispose:c,release:c})}var k=this.ca(a.unwrap(g[b.primaryKey])),m=F(this.rows.i()),E=b.h.i().indexOf(f),z=c(e(m),E);return p.c.extend({element:z,lb:t},{element:z,hijack:t})}.bind(this);return function(){}}function h(b,c,d){for(var e=b["__@__hijacked"];b.firstChild;)a.removeNode(b.firstChild);e&&e.e&&e.e(b,c,d);d.B?d.B(b,c,d):b.appendChild(t.createTextNode(""))}function v(b,c,d){var e=c[d.da],g=e&&a.unwrap(e),h=b["__@__hijacked"],f=d.oa.peek().join(" ");
b.className="ko-grid-td ko-grid-cell "+f+(h?" "+h.Xa:"");h&&h.update&&h.update(b,e,c,d);d.B?d.X(b,e,c,d):b.lastChild.nodeValue=d.J(g)}var g=window.Node.ELEMENT_NODE,t=window.document;a.bindingHandlers.__gridRow={init:function(){},update:function(a,b){var c=b(),d=c.classify,e=c.row(),c=1===c.index()%2?["ko-grid-tr","ko-grid-row","alternate"]:["ko-grid-tr","ko-grid-row"],d=d(e);a.className=c.concat(d).join(" ")}};a.bindingHandlers.__gridCell={init:function(a,b){var c=b();h(a,c.row,c.column());return{controlsDescendantBindings:!0}},
update:function(a,b){var c=b(),d=c.row(),c=c.column.peek();v(a,d,c)}};return{e:function(a){a.replace("body").fa("body",f);a.Oa("table").Ia("<div class=\"ko-grid-load-indicator\" data-bind=\"style: { display: data.rows.__dirty() ? 'block' : 'none' }\">Loading&hellip;</div>")},m:function(l,g,h){var f=[];this.source=l.dataSource;this.valueSelector=this.Qa=l.valueSelector||g.valueSelector||function(a){return a};this.observableValueSelector=this.ca=l.observableValueSelector||g.observableValueSelector||
this.Qa;this.predicates=this.f=a.observableArray(l.filters||[]);this.predicate=this.Ha=a.pureComputed(function(){return m.f.D(this.f().map(a.unwrap))}.bind(this));this.comparator=this.qa=a.observable(m.u.nb);this.offset=this.offset=a.observable(0);this.limit=this.za=a.observable(Number.POSITIVE_INFINITY);l=this.source.openView(function(a){return a.filteredBy(this.Ha).sortedBy(this.qa).offsetBy(this.offset).limitedTo(this.za)}.bind(this));f.push(l.dispose.bind(l));this.view=this.view=l;this.C=function(){};
this.l=function(a){var b=this.C;this.C=function(){a(b)}}.bind(this);f.push(d.call(this,h));f.push(b.call(this));f.push(c.call(this));f.push(e.call(this,h));this.o=function(){f.forEach(function(a){a()})}}}}(q,r,w,y,'<tbody class="ko-grid-tbody" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    <tr class="ko-grid-tr ko-grid-row"\n        data-bind="indexedRepeat: {\n            forEach: data.rows.displayed,\n            indexedBy: function(r) { return grid.data.observableValueSelector(ko.unwrap(r[grid.primaryKey])); },\n            as: \'row\',\n            at: \'rowIndex\',\n            beforeElementRecycling: data.rows.__handleElementRecycling,\n            afterElementRecycled: data.rows.__handleElementRecycled,\n            allowDeviation: true,\n            onDeviation: data.rows.__handleDisplayedRowsDeviate,\n            onSynchronization: data.rows.__handleDisplayedRowsSynchronized }"\n        data-repeat-bind="__gridRow: { classify: grid.data.rows.__classify, row: row, index: rowIndex }">\n\n        <td data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\', allowElementRecycling: false }"\n            data-repeat-bind="__gridCell: { row: row, column: column }"></td>\n    </tr>\n</tbody>');
y=function(a,p,m,k){function f(b){this.id=this.id="column-header-"+b.id;this.element=this.element=a.observable(null);this.rowSpan=this.rowSpan=a.observable(1);this.columnSpan=this.p=a.observable(1);this.label=this.label=b.label;this.column=this.H=b;this.columns=this.h=[b];this.V=function(a){this.rowSpan(a)}.bind(this)}function d(b){this.id=this.id="column-group-header-"+(b.id||"@__"+ ++g);this.element=this.element=a.observable(null);this.Ta=b;this.rowSpan=this.rowSpan=a.observable(b.height);this.columnSpan=
this.p=a.observable(1);this.label=this.label=a.observable(b.label);this.columns=this.h=[];this.V=function(a){this.h=[a];this.p(1)}.bind(this)}function b(a){function b(a){a.Ya.forEach(function(b){var c=d[b];if(!c)d[b]=a;else if(c!==a)throw Error("Column `"+b+"` is element of column group `"+c.label+"` as well as `"+a.label+"`.");});a.M&&b(a.M)}var d={};p.g.$(a,c.bind(this,null)).forEach(function(a){b(a)});return d}function c(a,b){var d=e(b),g=b.elements.filter(function(a){return"string"!==typeof a}),
h=b.elements.filter(function(a){return"string"===typeof a}),d={id:b.id,label:b.label,M:a,depth:a?a.depth+1:0,height:a?a.Fa-d:1,Fa:d,Ya:h};return g.length?p.g.$(g,c.bind(this,d)):d}function e(a){a=a.elements.filter(function(a){return"string"!==typeof a});return 1+Math.max.apply(Math,[0].concat(a.map(e)))}var h=window.document,v=window.Node,g=0;a.bindingHandlers.__gridHeader={init:function(b,c){var d=c()();d.element(b);a.utils.domNodeDisposal.addDisposeCallback(b,function(){d.element(null)});for(var e=
b.firstChild;e;){var g=e;g.nodeType===v.TEXT_NODE&&a.removeNode(g);e=e.nextSibling}b.insertBefore(h.createTextNode(""),b.firstChild);return{controlsDescendantBindings:!0}},update:function(a,b){var c=b()(),d=c.id.replace(/[\s]/g,"_");a.className=c.H?"ko-grid-th ko-grid-column-header "+d+" "+c.H.wa().join(" "):"ko-grid-th ko-grid-column-group-header "+d;d=c.h.map(function(a){return a.R()}).reduce(function(a,b){return a+b})+"px";a.style.width=d;a.style.maxWidth=d;a.rowSpan=c.rowSpan();a.colSpan=c.p();
for(d=a.firstChild;d.nodeType!==v.TEXT_NODE;)d=d.nextSibling;d.nodeValue=c.label()}};return{e:function(a){a.replace("head").fa(k)},m:function(c,e,g){function h(a,b,c){if(!a)return[];if(b[a.depth]&&b[a.depth].Ta===a){var e=a;do{var g=b[e.depth];g.h.push(c);g.p(g.p()+1);e=e.M}while(e);return[]}b.length=a.depth;var e=h(a.M,b,c),f=g=a.depth;a=k(v,new d(a));a.V(c);e[g]=b[f]=a;return e}function k(a,b){var c=b.id;return a[c]=a[c]||b}var p=b(c.columnGroups||[]),v={},q={},u=[];this.__rows=this.W=a.computed(function(){var b=
g.h.i(),c=0;b.forEach(function(a){a=p[a.id];c=Math.max(c,a?a.depth+a.Fa:0)});u.length=c+1;for(var d=0;d<u.length;++d)u[d]=u[d]||a.observableArray(),u[d].__rowId="header-row-"+d,u[d].valueWillMutate(),u[d]().length=0;var e=[];b.forEach(function(a){var b=p[a.id],d=b?b.depth+b.height:0;e.length=d;var g=k(q,new f(a));g.V(c-d+1);u[d]().push(g);a=h(b,e,a);for(b=0;b<a.length;++b)a[b]&&u[b]().push(a[b])});u.forEach(function(a){a.valueHasMutated()});return u});this.all=this.all=a.computed(function(){var a=
[];this.W().forEach(function(b){Array.prototype.push.apply(a,b())});return a}.bind(this));this.forColumn=this.jb=function(a){a="column-header-"+a.id;if(!Object.prototype.hasOwnProperty.call(q,a))throw Error("Es existiert kein Header f\u00fcr die gegebene Spalte.");return q[a]};var A=new m(function(b,c){return[b,a.contextFor(c).header()]});this.__handleClick=function(a,b){A.La(".ko-grid-column-header, .ko-grid-column-group-header").ua(b);return!b.defaultPrevented};this.Ea=A.w.bind(A);this.Da=function(a,
b){function c(a,d){d instanceof f&&b.apply(this,arguments)}var d=1<arguments.length;b=d?b:a;A.w.apply(A,d?[a,c]:[c])};this.onHeaderClick=this.Ea;this.onColumnHeaderClick=this.Da;this.o=function(){this.W.dispose();this.all.dispose()}.bind(this)}}}(q,r,y,'<thead class="ko-grid-thead" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n    \x3c!--before:headers--\x3e\n    <tr class="ko-grid-tr ko-grid-headers"\n        data-bind="indexedRepeat: { forEach: headers.__rows, indexedBy: \'__rowId\', as: \'headerRow\' }"\n        data-repeat-bind="click: headers.__handleClick">\n\n        <th class="ko-grid-th"\n            data-bind="indexedRepeat: { forEach: headerRow(), indexedBy: \'id\', as: \'header\' }"\n            data-repeat-bind="__gridHeader: header"></th>\n    </tr>\n    \x3c!--after:headers--\x3e\n</thead>');
B=function(a,p,m,k,f){a=a.bindingHandlers.grid=a.bindingHandlers.grid||{};return a.core=a.core||{columns:p,data:m,headers:k,layout:f}}(q,D,w,y,function(a){function p(a,b,c,e){var h=a.element,f=h.querySelector(".ko-grid-table-scroller-padding"),g=h.querySelector(".ko-grid-table-scroller"),m=h.querySelector(".ko-grid-thead"),l=h.querySelector(".ko-grid-tfoot"),n=!1;return function(a){if(!n)try{b(n=!0);var d=g.scrollLeft;a&&a();c.forEach(function(a){a.call(h)});k(h,function(){f.style.borderTopWidth=
Math.max(m.clientHeight,0)+"px";f.style.borderBottomWidth=Math.max(l.clientHeight,0)+"px"});g.scrollLeft=d;e.forEach(function(a){a.call(h)})}finally{b(!1),n=!1}}}function m(a){a=a.element;var b=a.querySelector(".ko-grid-table-scroller"),c=a.querySelector(".ko-grid-thead"),e=a.querySelector(".ko-grid-tfoot");b.addEventListener("scroll",function(){var a=-b.scrollLeft+"px";c.style.left=a;e.style.left=a})}function k(a,b){if(a.offsetWidth&&a.offsetHeight)b();else{var c=a.parentNode,e=f.createComment("placeholder");
c.replaceChild(e,a);var h=a.style.position;a.style.position="absolute";a.style.visibility="hidden";f.body.appendChild(a);try{b()}finally{c.replaceChild(a,e),a.style.position=h,a.style.visibility="visible"}}}var f=window.document;return{e:function(){},m:function(d,b,c){function e(a){a&&a()}var h=a.observable(!1);this.recalculate=this.Ka=function(a){e(a)};var k=a.computed(function(){h()||(c.h.i().forEach(function(a){a.width()}),e())}),g=[],t=[];this.la=function(a){g.push(a)};this.ka=function(a){t.push(a)};
this.beforeRelayout=this.la;this.afterRelayout=this.ka;this.C=function(){m.call(this,c);e=p(c,h,g,t);c.Ga(e)}.bind(this);this.determineCellDimensions=this.fb=function(a){var b=f.createElement("div");b.className="ko-grid-td ko-grid-cell";b.appendChild("string"===typeof a?f.createTextNode(a):a);b.style.position="absolute";b.style.visibility="hidden";f.body.appendChild(b);try{return{width:b.offsetWidth,height:b.offsetHeight}}finally{f.body.removeChild(b)}};this.o=function(){k.dispose()}}}}(q));(function(a,
p){function m(a,c){if(p.c.q(d,a))throw Error("Extension id or alias already in use: `"+a+"`.");d[a]=c;c.U.push(a);return c}function k(a,c){this.Ja=a;this.Y=c.Y||[];this.xa=c.xa||function(){};this.m=c.m;this.U=[]}var f=a.bindingHandlers.grid=a.bindingHandlers.grid||{},d=f.extensions=f.extensions||{};f.eb=function(a,c){return m(a,new k(a,c))};f.P=function(a){if(!p.c.q(d,a))throw Error("No known extension id or alias: `"+a+"`.");return d[a]};f.bb=function(a,c){return m(a,f.P(c))};f.cb=function(a,c){var d=
f.P(c);a.forEach(function(a){return m(a,d)});return d};k.prototype={get pb(){return this.U.slice()},va:function(a,c){var d=this.ia(a,function(a){throw Error("Conflicting configurations "+a.map(function(a){return"`"+a+"`"}).join(", ")+" (configuration: `"+c+"`).");});if(!d)throw Error("The extension `"+this.Ja+"` must be configured (configuration: `"+c+"`)");return a[d]},Db:function(a){var c=this.ia(a,function(a){throw Error("Conflicting binding values "+a.map(function(a){return"`"+a+"`"}).join(", ")+
".");});return a[c]},ia:function(a,c){var d=this.U.filter(function(c){return p.c.q(a,c)});1<d.length&&c(d);return d[0]}};return d})(q,r);return function(a){return a}(function(a,p,m){function k(c,d){function f(){var a=q[c];d(a.$a,a.Cb,a.hb)}q[c]?f():a([c],function(a){function d(e){e=b.P(e);var f=e.Ja,h=e.va(p,c);if(!m.g.contains(t,f)){if(m.g.contains(r,f))throw Error("Dependency-Cycle: .. -> "+r.join(" -> ")+" -> "+f+" -> ..");r.push(f);e.Y.forEach(d);e.xa(k,h,a);if(r.pop()!==f)throw Error("Assertion error.");
t.push(f)}}var k=new C('<div class="ko-grid">\n    \x3c!--before:grid--\x3e\n    <div class="ko-grid-table-container">\n        \x3c!--before:table--\x3e\n        <div class="ko-grid-table-scroller-padding">\n            <div class="ko-grid-table-scroller">\n                <table class="ko-grid-table" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\n                    \x3c!--columns--\x3e\n                    \x3c!--head--\x3e\n                    <tfoot class="ko-grid-tfoot" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\x3c!--tfoot--\x3e</tfoot>\n                    \x3c!--body--\x3e\n                </table>\n            </div>\n        </div>\n        \x3c!--after:table--\x3e\n    </div>\n    \x3c!--after:grid--\x3e\n</div>');
e.forEach(function(b){b.e(k,a)});var p=a.extensions,t=[],r=[];Object.keys(p).forEach(d);var u="ko-grid-template-"+c;h.b(u,k.Wa());q[c]={$a:a,Cb:u,hb:t};f()})}function f(a,b){this.Va=b;this.primaryKey=this.primaryKey=b.primaryKey;this.rootElement=a;this.element=this.element=null;this.o=function(){};this.l=function(){};this.Ga=function(a){if(!this.l)throw Error("Illegal state: postApplyBindings-callbacks have been called already.");var b=this.l;this.l=function(){b();a()}}.bind(this)}var d=window.document,
b=p.bindingHandlers.grid=p.bindingHandlers.grid||{},c=["columns","headers","data","layout"],e=c.map(function(a){return B[a]}),h=new p.nativeTemplateEngine;h.b=function(a,b){var c=d.createElement("script");c.id=a;c.type="text/html";c.text=b;d.querySelector("head").appendChild(c)};p.bindingHandlers.grid.init=function(a,d,e,n,q){var r=d(),v=r.config;k(v,function(d,e,k){var l=[],n=new f(a,r);p.utils.domNodeDisposal.addDisposeCallback(a,function(){n.o();l.forEach(function(a){a()})});m.c.aa(B,function(a,
b){var c=new b.m(r,d,n);n[a]=c;n.h=n.columns;n.headers=n.headers;n.data=n.data;n.b=n.layout;"function"===typeof c.o&&l.push(c.o.bind(c))});var t=d.extensions,x=r.extensions||{},y=n.extensions=n.ib={};for(k.forEach(function(a){a=b.P(a);var c=a.va(t,v),e=a.Db(x)||{};if((!1!==c.enabled||!0===e.enabled)&&!1!==e.enabled){a.Y.forEach(function(a){if(!y[a])throw Error("Dependency '"+a+"' was disabled.");});var f=new a.m(e,c,n,r,d);a.pb.forEach(function(a){y[a]=f});"function"===typeof f.dispose&&l.push(f.dispose.bind(f))}});a.firstChild;)p.removeNode(a.firstChild);
k=q.createChildContext(n,"grid");p.renderTemplate(e,k,{templateEngine:h},a);var w=a.querySelector(".ko-grid");n.element=w;n.element=w;m.c.aa(t,function(a){w.className+=" with-"+m.L.ra(a)});c.forEach(function(a){n[a].C&&n[a].C()});n.l();n.l=null});return{controlsDescendantBindings:!0}};p.bindingHandlers.grid.update=function(){};var q={};p.bindingHandlers._gridWidth={init:function(){},update:function(a,b){var c=b();a.style.width=c;a.style.maxWidth=c}};return b}(x,q,r))});