/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
(function(x){"function"===typeof define&&define.amd?define(["require","knockout","ko-indexed-repeat"],x):window["ko-grid"]=x(function(q,v){if(!Array.isArray(q)||1!==q.length||"string"!==typeof q[0]||"function"!==typeof v)throw Error("Assertion error.");var x=window.ko.bindingHandlers.grid.config=window.ko.bindingHandlers.grid.config||{};v(x[q[0]])},window.ko)})(function(x,q){var v,B,C,y,D,A;v=function(){return function(a){return a}(function(a,c,e,h){return{o:a,a:c,l:e,Ma:h}}(function(){function a(a,
c){return a&&"function"===typeof a.valueOf&&c&&"function"===typeof c.valueOf?a.valueOf()<=c.valueOf()?a.valueOf()<c.valueOf()?-1:0:1:a<=c?a<c?-1:0:1}function c(a,c){var f=a.length,m=Array(f),d=Array(f),b;for(b=0;b<f;++b)m[b]=b,d[b]=a[b];b=a;a=d;d=b;m.sort(function(d,b){return c(a[d],a[b])||d-b});for(b=0;b<f;++b)d[b]=a[m[b]];return d}return{contains:function(a,c){return 0<=a.indexOf(c)},R:function(a,c){return Array.prototype.concat.apply([],a.map(c))},La:function(e,h){var f=h||a;window.chrome?f=c(e,
f):(e.sort(f),f=e);return f}}}(),function(){function a(a){return function(){return a}}return{jb:a(!0),Ya:a(!1),b:a(void 0),cb:a(null),Oa:a(0),Ua:a,ta:function(a){return a}}}(),function(){function a(a,e){return Object.prototype.hasOwnProperty.call(a,e)}return{Ra:function(a,e){return a===e||!(!a||"function"!==typeof a.valueOf||!e||"function"!==typeof e.valueOf||a.valueOf()!==e.valueOf())},extend:function(a){Array.prototype.slice.call(arguments,1).forEach(function(e){for(var h=Object.keys(e),f=0,m=h.length;f<
m;f++){var d=h[f],b=Object.getOwnPropertyDescriptor(e,d);void 0!==b&&b.enumerable&&Object.defineProperty(a,d,b)}});return a},D:function(c,e){for(var h in c)a(c,h)&&e(h,c[h])},S:a}}(),{la:function(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},Va:function(a){return a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(a){var c=arguments;return a.replace(/{(\d+)}/g,function(a,h){var f=parseInt(h,10)+1;return typeof c.length<=f?a:c[f]})}}))}();B=function(){var a=
/^[a-z]+(-[a-z]+)*$/,c=/\x3c!--(?:(before|after):)?([a-z]+(-[a-z]+)*)--\x3e*/g;return function(e){function h(a){a=a||function(a,n){return n+a};return function(b){var n=f(b,1);return{ua:function(g,l){var w=l?g:null,b=(l=l?l:g)?w:null,k=l,w=a;b&&d(b,2);m(k);b=b?f(b,3)+k+f(b,4):k;w=w(n,b);t=t.replace(n,w)}}}}function f(a,d){function n(l){if(b[a]!==l)throw Error("Operation is not defined for placeholder `"+a+"`.");}if(!b[a])throw Error("Unknown placeholder id `"+a+"`.");var g="\x3c!--"+a+"--\x3e",l="\x3c!--before:"+
a+"--\x3e",w="\x3c!--after:"+a+"--\x3e";switch(d){case 1:return n(1),delete b[a],g;case 2:return n(1),g;case 3:return n(2),l;case 4:return n(2),w;case 5:case 6:return 1===b[a]?"\x3c!--"+a+"--\x3e":5===d?w:l}throw Error("Assertion error. Unkown operator: `"+d+"`");}function m(a){for(var b;b=c.exec(a);){var n=b[1],g="before"===n;b=b[2];if(n&&1!==(a.match(new RegExp((g?"after":"before")+":"+b,"g"))||[]).length)throw Error("Multiple or unmatched before-/after-placeholders for placeholder id `"+b+"`.");
n&&!g||d(b,n?2:1)}}function d(d,f){if(!a.test(d))throw Error("Invalid placeholder id `"+d+"`");if(b[d])throw Error("Placeholder id `"+d+"` is already taken.");b[d]=f}var b={},t=e;m(t);this.replace=function(a){return{K:h(function(a,b){return b})(a).ua}};this.ga=function(){return t.replace(c,"")}}}();C=function(a,c,e){function h(a){return null===a?"":""+a}function f(f,d,b){this.id=this.id=b.id;this.property=this.I=b.property||this.id;this.e=!b.hidden;this.visible=this.visible=function(){return this.e}.bind(this);
this.label=this.label=a.observable(b.label);this.width=this.width=a.observable(b.width);this.widthInPixels=this.J=function(){var a=this.width();if("px"!==a.substr(-2))throw Error("The only currently supported column width values are absolute pixel lengths.");return parseInt(a.substring(0,a.length-2),10)}.bind(this);this.T=a.observableArray(b.headerClasses||b.classes||[]);this.O=a.observableArray(b.cellClasses||b.classes||[]);this.qa=a.observableArray(b.footerClasses||b.classes||[]);this.headerClasses=
this.T;this.cellClasses=this.O;this.footerClasses=this.qa;this.metadata=this.ya=d.columnMetadataProvider?d.columnMetadataProvider(f,b):{};this.renderValue=this.s=d.cellValueRenderer?d.cellValueRenderer.bind(void 0,this):h;this.Ia=function(a){this.s=a(this.s)}.bind(this);this.Ha=function(a){a=a({i:this.k,update:this.N});if(!a||!a.i||!a.update)throw Error("The cell value binding must define an `init` as well as an `update` method.");this.k=a.i;this.N=a.update}.bind(this);this.overrideValueRendering=
this.Ia;this.overrideValueBinding=this.Ha}a.bindingHandlers.__gridColumn={init:c.a.b,update:function(a,d){var b=d();a.style.width=b.width()}};return{i:function(a){a.replace("columns").K(e)},f:function(c,d,b){function e(a){a=new f(b,d,a);d.columnInitializer&&d.columnInitializer(a);return a}var h=[];this.all=this.all=a.observableArray(c.columns.map(e));this.byId=this.ha=function(a){var b=this.$(a);if(!b)throw Error("The column id `"+a+"` is already taken.");return b}.bind(this);this.tryById=this.$=
function(a){var b=this.all().filter(function(l){return l.id===a});if(1<b.length)throw Error("Assertion error: Multiple columns with id `"+a+"`.");return b[0]}.bind(this);var r=a.observable(this.all().filter(function(a){return a.e}));this.displayed=this.d=function(){return r()};this.show=function(a){this.p(function(b){return b.e||b===a})}.bind(this);this.sa=function(a){this.p(function(b){return b.e&&b!==a})}.bind(this);this.show=this.show;this.hide=this.sa;this.reorder=this.Ka=function(a){var b=this.all().slice(),
l=[];a.forEach(function(a){b.splice(b.indexOf(a),1);l.push(a)});if(b.length)throw Error("The new column order must contain all columns.");this.all(l);this.p(function(a){return a.e})}.bind(this);this.showOnlyThoseWhich=this.p=function(a){var b=this.all();a=b.filter(a);b.forEach(function(a){a.e=!1});a.forEach(function(a){a.e=!0});r(a)}.bind(this);this._combinedWidthInPixels=this.M=a.computed(function(){for(var a=0,b=this.d(),l=0;l<b.length;++l)a+=b[l].J();return a}.bind(this));h.push(this.M);this.add=
this.add=function(a){a=e({id:"#"+a.id,label:a.label,hidden:a.hidden||!1,width:a.width});this.all.unshift(a);this.p(function(a){return a.e});return a}.bind(this);this.g=function(){h.forEach(function(a){a.dispose()})}}}}(q,v,'<colgroup class="ko-grid-colgroup">\n    <col class="ko-grid-col" data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\' }" data-repeat-bind="__gridColumn: column()">\n</colgroup>');y=function(a,c){function e(f){var c=f.defaultPrevented;a.l.extend(this,
f,{preventDefault:function(){c=!0;return f.preventDefault()},gb:function(){c=!0},get defaultPrevented(){return c}})}function h(a,c){this.F=a;this.Z=c}return function(f){function m(b,f,e){function m(a){a=Array.prototype.slice.call(b.querySelectorAll(a)).filter(function(a){return c.wa(a,f.target)});return a.length?a[a.length-1]:void 0}var n=c.na.bind(null,b),g=d.map(function(a){var d=a.Z?m(a.Z):b;return{F:a.F,match:d,depth:d?n(d):-1}}).filter(function(a){return!!a.match});a.o.La(g,function(a,b){return b.depth-
a.depth});g.forEach(function(a){a.F.apply(b,e)})}f=f||function(a){return[a]};var d=[];this.m=function(a,f){var c=1<arguments.length?a:void 0;f=1<arguments.length?f:a;d.push(new h(f,c))};this.Y=function(a){return{Q:function(d){var h=c.element.ia(d.target,a);h&&(d=new e(d),m(h,d,f(d,h)))}}}}}(v,function(){return function(a){return a}(function(){function a(a,c){var d=(" "+a+" ").replace(" "+c+" "," ");return d.substring(" "===d[0]?1:0," "===d[d.length-1]?d.length-1:d.length)}function c(a,c){return!!(a.compareDocumentPosition(c)&
16)}var e=window.Element,h=e.prototype.webkitMatchesSelector||e.prototype.mozMatchesSelector||e.prototype.msMatchesSelector;return{na:function(a,c){for(var d=0;c;){if(c===a)return d;c=c.parentNode;++d}throw Error("The given node is not part of the subtree.");},wa:function(a,e){return a===e||c(a,e)},ib:c,element:{ia:function(a,c){do{if(h.call(a,c))return a;a=a.parentElement}while(a);return null},matches:function(a,c){return h.call(a,c)}},Sa:{add:function(c,e){return a(c,e)+" "+e},$a:function(a,c){return 0<=
(" "+a+" ").indexOf(" "+c+" ")},remove:a}}}())}());D=function(a,c,e,h){function f(a){this.L(function(b){b();this.j=a.v.querySelector(".ko-grid-tbody")}.bind(this));return function(){this.j=null}.bind(this)}function m(){var b=[],d=a.pureComputed(function(){var b=this.X().map(a.unwrap);return function(a){for(var d=0;d<b.length;d++)if(!b[d](a))return!1;return!0}}.bind(this)),c=a.pureComputed(function(){return this.P()}.bind(this)),k={};this.rows=this.rows=k;k.all=a.observableArray([]);k.C=a.observableArray([]);
k.filtered=k.C;k.H=a.observableArray([]);k.ordered=k.H;k.d=a.observableArray([]);k.displayed=k.d;k.B=a.observable(!1).extend({bb:"always"});k.displayedSynchronized=k.B;k.__handleDisplayedRowsDeviate=function(){this.rows.B(!1)}.bind(this);k.__handleDisplayedRowsSynchronized=function(){this.rows.B(!0)}.bind(this);this.ba(function(a){a();a=this.source.eb();var g=a.Za(d),e=this.rows.Qa=g.fb(c),f=e.Ta(this.offset,this.V);b.push(a,g,e,f);b.push(a.values.subscribe(function(a){this.rows.all(a)}.bind(this)),
g.values.subscribe(function(a){this.rows.C(a)}.bind(this)),e.values.subscribe(function(a){this.rows.H(a)}.bind(this)),f.Aa.subscribe(function(a){this.rows.d(a)}.bind(this)));k.all(a.values());k.C(g.values());k.H(e.values());k.d(f.Aa())}.bind(this));var g=[];k.__classify=function(a){var b=g.map(function(b){return b(a)});return Array.prototype.concat.apply([],b)};k.va=function(a){g.push(a)};k.installClassifier=k.va;return function(){b.forEach(function(a){a.dispose()})}}function d(){function b(d,c){var k=
a.contextFor(c),g=k.row(),k=k.column();return[d,g[k.I],g,k]}function d(a){return function(b){a.Y(".ko-grid-cell").Q(b);return!b.defaultPrevented}}var g=new e(b),k=new e(b),f=new e(b),n=new e(b);this.Ea=g.m.bind(g);this.Ba=k.m.bind(k);this.Da=f.m.bind(f);this.Ca=n.m.bind(n);this["onCellMouseDown "]=this.Ea;this["onCellClick "]=this.Ba;this["onCellDoubleClick "]=this.Da;this["onCellContextMenu "]=this.Ca;this.L(function(a){a();this.j.addEventListener("mousedown",d(g));this.j.addEventListener("click",
d(k));this.j.addEventListener("dblclick",d(f));this.j.addEventListener("contextmenu",d(n))}.bind(this));return c.a.b}function b(b){function d(a,b){for(var c=a.firstChild,g=-1;c;){if(c.nodeType===u&&"TD"===c.tagName&&0<=(" "+c.className+" ").indexOf("td")&&++g===b)return c;c=c.nextSibling}throw Error("Column `"+b+"` does not exist.");}var g=function(a){for(var b=this.j.firstChild,d=-1;b;){if(b.nodeType===u&&"TR"===b.tagName&&0<=(" "+b.className+" ").indexOf("ko-grid-row")&&++d===a)return b;b=b.nextSibling}throw Error("Row `"+
a+"` does not exist.");}.bind(this);this.lookupCell=this.xa=function(c,e){var f=this.rows.d().indexOf(c),h=b.c.d().indexOf(e),p=d(g(f),h);return{element:p,hijack:function(b){function d(){for(p.removeAttribute("data-hijacked");p.firstChild;)a.removeNode(p.firstChild);var b=a.contextFor(p).hb();e.k?e.k(p,b,e):p.appendChild(n.createTextNode(""));t(p,b(),e)}if(p.hasAttribute("data-hijacked"))throw Error("Illegal state: This cell is already hijacked.");for(;p.firstChild;)a.removeNode(p.firstChild);p.className+=
" "+b;p.setAttribute("data-hijacked","hijacked "+b);return{dispose:d,release:d}}}}.bind(this);return c.a.b}function t(b,d,c){var g=d[c.I],e=g&&a.unwrap(g),f=b.getAttribute("data-hijacked"),n=c.O.peek().join(" ");b.className="ko-grid-td ko-grid-cell "+n+(f?" "+f:"");f||(c.k?c.N(b,g,d,c):b.lastChild.nodeValue=c.s(e))}var u=window.Node.ELEMENT_NODE,r=c.a.Oa,n=window.document,g={Pa:r,i:function(a){a.replace("body").K(h)},f:function(g,e,E){var k=[];this.source=g.dataSource;this.valueSelector=this.aa=g.valueSelector||
e.valueSelector||c.a.ta;this.observableValueSelector=this.za=g.observableValueSelector||e.observableValueSelector||this.aa;this.predicates=this.X=a.observableArray(g.filters||[]);this.comparator=this.P=a.observable(r);this.offset=this.offset=a.observable(0);this.limit=this.V=a.observable(Number.POSITIVE_INFINITY);this.q=c.a.b;this.ba=function(a){var b=this.q;this.q=function(){a(b)}}.bind(this);this.n=c.a.b;this.L=function(a){var b=this.n;this.n=function(){a(b)}}.bind(this);k.push(f.call(this,E));
k.push(m.call(this));k.push(d.call(this));k.push(b.call(this,E));this.g=function(){k.forEach(function(a){a()})}}.bind(this)};a.bindingHandlers.__gridRow={init:c.a.b,update:function(a,b){var d=b(),c=d.classify,g=d.row(),d=1===d.index()%2?["ko-grid-tr","ko-grid-row","alternate"]:["ko-grid-tr","ko-grid-row"],c=c(g);a.className=d.concat(c).join(" ")}};a.bindingHandlers.__gridCell={init:function(b,d){for(var c=d(),g=c.row,c=c.column,e=c();b.firstChild;)a.removeNode(b.firstChild);e.k?e.k(b,g,c):b.appendChild(n.createTextNode(""));
return{controlsDescendantBindings:!0}},update:function(a,b){var d=b(),c=d.row(),d=d.column.peek();t(a,c,d)}};return g}(q,v,y,'<tbody class="ko-grid-tbody" data-bind="_gridWidth: columns._combinedWidthInPixels() + \'px\'">\n    \x3c!--before:tbody--\x3e\n    <tr class="ko-grid-tr ko-grid-row"\n        data-bind="indexedRepeat: {\n            forEach: data.rows.displayed,\n            indexedBy: function(r) { return grid.data.observableValueSelector(ko.unwrap(r[grid.primaryKey])); },\n            as: \'row\',\n            at: \'rowIndex\',\n            allowDeviation: true,\n            onDeviation: data.rows.__handleDisplayedRowsDeviate,\n            onSynchronization: data.rows.__handleDisplayedRowsSynchronized }"\n        data-repeat-bind="__gridRow: { classify: grid.data.rows.__classify, row: row, index: rowIndex }">\n\n        <td data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\', allowElementRecycling: false }"\n            data-repeat-bind="__gridCell: { row: row, column: column }"></td>\n    </tr>\n    \x3c!--after:tbody--\x3e\n</tbody>');
y=function(a,c,e,h){function f(b){this.id=this.id="column-header-"+b.id;this.element=this.element=a.observable(null);this.rowSpan=this.rowSpan=a.observable(1);this.columnSpan=this.h=a.observable(1);this.label=this.label=b.label;this.column=this.w=b;this.columns=this.c=[b];this.t=function(a){this.rowSpan(a)}.bind(this)}function m(b){this.id=this.id="column-group-header-"+(b.id||"@__"+ ++r);this.element=this.element=a.observable(null);this.ca=b;this.rowSpan=this.rowSpan=a.observable(b.height);this.columnSpan=
this.h=a.observable(1);this.label=this.label=a.observable(b.label);this.columns=this.c=[];this.t=function(a){this.c=[a];this.h(1)}.bind(this)}function d(a){function d(a){a.ja.forEach(function(b){var d=e[b];if(!d)e[b]=a;else if(d!==a)throw Error("Column `"+b+"` is element of column group `"+d.label+"` as well as `"+a.label+"`.");});a.r&&d(a.r)}var e={};c.o.R(a,b.bind(this,null)).forEach(function(a){d(a)});return e}function b(a,d){var e=t(d),f=d.elements.filter(function(a){return"string"!==typeof a}),
k=d.elements.filter(function(a){return"string"===typeof a}),e={id:d.id,label:d.label,r:a,depth:a?a.depth+1:0,height:a?a.W-e:1,W:e,ja:k};return f.length?c.o.R(f,b.bind(this,e)):e}function t(a){a=a.elements.filter(function(a){return"string"!==typeof a});return 1+Math.max.apply(Math,[0].concat(a.map(t)))}var u=window.document,r=0,n={i:function(a){a.replace("head").K("headers",h)},f:function(b,c,n){function h(a,b,d){if(!a)return[];if(b[a.depth]&&b[a.depth].ca===a){var c=a;do{var e=b[c.depth];e.c.push(d);
e.h(e.h()+1);c=c.r}while(c);return[]}b.length=a.depth;var c=h(a.r,b,d),f=e=a.depth;a=k(t,new m(a));a.t(d);c[e]=b[f]=a;return c}function k(a,b){var d=b.id;return a[d]=a[d]||b}var r=d(b.columnGroups||[]),t={},u={},p=[];this.__rows=this.u=a.computed(function(){var b=n.c.d(),d=0;b.forEach(function(a){a=r[a.id];d=Math.max(d,a?a.depth+a.W:0)});p.length=d+1;for(var c=0;c<p.length;++c)p[c]=p[c]||a.observableArray(),p[c].__rowId="header-row-"+c,p[c].valueWillMutate(),p[c]().length=0;var e=[];b.forEach(function(a){var b=
r[a.id],c=b?b.depth+b.height:0;e.length=c;var g=k(u,new f(a));g.t(d-c+1);p[c]().push(g);a=h(b,e,a);for(b=0;b<a.length;++b)a[b]&&p[b]().push(a[b])});p.forEach(function(a){a.valueHasMutated()});return p});this.all=this.all=a.computed(function(){var a=[];this.u().forEach(function(b){Array.prototype.push.apply(a,b())});return a}.bind(this));this.forColumn=this.ra=function(a){a="column-header-"+a.id;if(!Object.prototype.hasOwnProperty.call(u,a))throw Error("Es existiert kein Header f\u00fcr die gegebene Spalte.");
return u[a]};var z=new e(function(b,d){return[b,a.contextFor(d).header()]});this.__handleClick=function(a,b){z.Y(".ko-grid-column-header, .ko-grid-column-group-header").Q(b);return!b.defaultPrevented};this.Ga=z.m.bind(z);this.Fa=function(a,b){function d(a,c){var e=arguments;c instanceof f&&b.apply(this,e)}var c=1<arguments.length;b=c?b:a;z.m.apply(z,c?[a,d]:[d])};this.onHeaderClick=this.Ga;this.onColumnHeaderClick=this.Fa;this.g=function(){this.u.dispose();this.all.dispose()}.bind(this)}.bind(this)};
a.bindingHandlers.__gridHeader={init:function(b,d){var c=d()();c.element(b);for(a.utils.domNodeDisposal.addDisposeCallback(b,function(){c.element(null)});b.firstChild;)a.removeNode(b.firstChild);b.appendChild(u.createTextNode(""));return{controlsDescendantBindings:!0}},update:function(a,b){var d=b()(),c=d.id.replace(/[\s]/g,"_");a.className=d.w?"ko-grid-th ko-grid-column-header "+c+" "+d.w.T().join(" "):"ko-grid-th ko-grid-column-group-header "+c;c=d.c.map(function(a){return a.J()}).reduce(function(a,
b){return a+b})+"px";a.style.width=c;a.style.maxWidth=c;a.rowSpan=d.rowSpan();a.colSpan=d.h();a.firstChild.nodeValue=d.label()}};return n}(q,v,y,'<thead class="ko-grid-thead" data-bind="_gridWidth: columns._combinedWidthInPixels() + \'px\'">\n    \x3c!--before:thead--\x3e\n    <tr class="ko-grid-tr ko-grid-headers"\n        data-bind="indexedRepeat: { forEach: headers.__rows, indexedBy: \'__rowId\', as: \'headerRow\' }"\n        data-repeat-bind="click: headers.__handleClick">\n\n        <th class="ko-grid-th"\n            data-bind="indexedRepeat: { forEach: headerRow(), indexedBy: \'id\', as: \'header\' }"\n            data-repeat-bind="__gridHeader: header"></th>\n    </tr>\n    \x3c!--after:thead--\x3e\n</thead>');
A=function(a,c,e,h,f){a=a.bindingHandlers.grid=a.bindingHandlers.grid||{};return a.core=a.core||{columns:c,data:e,headers:h,layout:f}}(q,C,D,y,function(a,c){function e(a,b,c,e){var h=a.v.querySelector(".ko-grid"),n=h.querySelector(".ko-grid-table-scroller-padding"),g=h.querySelector(".ko-grid-table-scroller"),l=h.querySelector(".ko-grid-thead"),w=h.querySelector(".ko-grid-tfoot"),m=!1;return function(a){if(!m)try{b(m=!0);var d=g.scrollLeft;a&&a();c.forEach(function(a){a.call(h)});f(h,function(){n.style.borderTopWidth=
Math.max(l.clientHeight,0)+"px";n.style.borderBottomWidth=Math.max(w.clientHeight,0)+"px"});g.scrollLeft=d;e.forEach(function(a){a.call(h)})}finally{b(!1),m=!1}}}function h(a){a=a.v.querySelector(".ko-grid");var b=a.querySelector(".ko-grid-table-scroller"),c=a.querySelector(".ko-grid-thead"),e=a.querySelector(".ko-grid-tfoot");b.addEventListener("scroll",function(){var a=-b.scrollLeft+"px";c.style.left=a;e.style.left=a})}function f(a,b){if(a.offsetParent)b();else{var c=a.parentNode,e=m.createComment("placeholder");
c.replaceChild(e,a);var f=a.style.position;a.style.position="absolute";a.style.visibility="hidden";m.body.appendChild(a);try{b()}finally{c.replaceChild(a,e),a.style.position=f,a.style.visibility="visible"}}}var m=window.document;return{i:c.a.b,f:function(c,b,f){function u(a){a&&a()}var r=a.observable(!1);this.recalculate=this.Ja=function(a){u(a)};var n=a.computed(function(){r()||(f.c.d().forEach(function(a){a.width()}),u())}),g=[],l=[];this.fa=function(a){g.push(a)};this.ea=function(a){l.push(a)};
this.beforeRelayout=this.fa;this.afterRelayout=this.ea;this.n=function(){h.call(this,f);u=e(f,r,g,l);u()}.bind(this);this.determineCellDimensions=this.ma=function(a){var b=m.createElement("div");b.className="ko-grid-td ko-grid-cell";b.appendChild("string"===typeof a?m.createTextNode(a):a);b.style.position="absolute";b.style.visibility="hidden";m.body.appendChild(b);try{return{width:b.offsetWidth,height:b.offsetHeight}}finally{m.body.removeChild(b)}};this.g=function(){n.dispose()}}.bind(this)}}(q,
v));(function(a,c){function e(a,b){if(c.l.S(m,a))throw Error("Extension id or alias already in use: `"+a+"`.");return m[a]=b}function h(a){this.A=a.A||[];this.U=a.U||c.a.b;this.f=a.f}var f=a.bindingHandlers.grid=a.bindingHandlers.grid||{},m=f.extensions=f.extensions||{};f.Xa=function(a,b){return e(a,new h(b))};f.G=function(a){if(!c.l.S(m,a))throw Error("No known extension id or alias: `"+a+"`.");return m[a]};f.Wa=function(a,b){return e(a,f.G(b))};return m})(q,v);return function(a){return a}(function(a,
c,e){function h(b,c){function f(){var a=r[b];c(a.ka,a.Na,a.pa)}r[b]?f():a([b],function(a){function c(f){var l=d.G(f);if(!e.o.contains(m,f)){if(!l)throw Error("Extension  '"+f+"' is not defined/loaded.");if(e.o.contains(q,f))throw Error("Dependency-Cycle: .. -> "+q.join(" -> ")+" -> "+f+" -> ..");if(!h[f])throw Error("The extension '"+f+"' must be configured (configuration: '"+b+"')");q.push(f);l.A.forEach(c);l.U(g,h[f],a);if(q.pop()!==f)throw Error("Assertion error.");m.push(f)}}var g=new B('<div class="ko-grid">\n    \x3c!--before:grid--\x3e\n    <div class="ko-grid-table-container">\n        \x3c!--before:table--\x3e\n        <div class="ko-grid-table-scroller-padding">\n            <div class="ko-grid-table-scroller">\n                <table class="ko-grid-table" data-bind="_gridWidth: columns._combinedWidthInPixels() + \'px\'">\n                    \x3c!--columns--\x3e\n                    \x3c!--head--\x3e\n                    <tfoot class="ko-grid-tfoot" data-bind="_gridWidth: columns._combinedWidthInPixels() + \'px\'">\x3c!--tfoot--\x3e</tfoot>\n                    \x3c!--body--\x3e\n                </table>\n            </div>\n        </div>\n        \x3c!--after:table--\x3e\n    </div>\n    \x3c!--after:grid--\x3e\n</div>');
t.forEach(function(b){b.i(g,a)});var h=a.extensions,m=[],q=[];e.l.D(h,c);var p="grid-template-"+b;u.da(p,g.ga());r[b]={ka:a,Na:p,pa:m};f()})}function f(a,b){this.elementId=this.oa=a.id;this.primaryKey=this.primaryKey=b.primaryKey;this.v=a;c.observableArray([]);this.g=e.a.b}var m=window.document,d=c.bindingHandlers.grid=c.bindingHandlers.grid||{},b=["columns","headers","data","layout"],t=b.map(function(a){return A[a]}),u=new c.nativeTemplateEngine;u.da=function(a,b){var c=m.createElement("script");
c.id=a;c.type="text/html";c.text=b;m.querySelector("head").appendChild(c)};c.bindingHandlers.grid.init=function(a,g,m,q,r){var k=g();h(k.config,function(g,h,m){var p=[],l=new f(a,k);c.utils.domNodeDisposal.addDisposeCallback(a,function(){l.g();p.forEach(function(a){a()})});e.l.D(A,function(a,b){var c=new b.f(k,g,l);l[a]=c;l.c=l.columns;l.headers=l.headers;l.data=l.data;l.ab=l.layout;"function"===typeof c.g&&p.push(c.g.bind(c))});var q=g.extensions,t=k.extensions,v=l.extensions={};for(m.forEach(function(a){var b=
d.G(a),c=q[a],e=t?t[a]||{}:{};!1===c.enabled&&!0!==e.enabled||!1===e.enabled||(b.A.forEach(function(a){if(!v[a])throw Error("Dependency '"+a+"' was disabled.");}),b=new b.f(e,c,l,k,g),v[a]=b,"function"===typeof b.dispose&&p.push(b.dispose.bind(b)))});a.firstChild;)c.removeNode(a.firstChild);b.forEach(function(a){l[a].q&&l[a].q()});m=r.createChildContext(l,"grid");c.renderTemplate(h,m,{templateEngine:u},a);var w=a.querySelector(".ko-grid");e.l.D(q,function(a){w.className+=" with-"+e.Ma.la(a)});b.forEach(function(a){l[a].n&&
l[a].n()})});return{controlsDescendantBindings:!0}};c.bindingHandlers.grid.update=e.a.b;var r={};c.bindingHandlers._gridWidth={init:e.a.b,update:function(a,b){var c=b();a.style.width=c;a.style.maxWidth=c}};return d}(x,q,v))});
